(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{300:function(t,e,r){var n,o,h,d=(n=new Date,o=4,h={setLogLevel:function(t){o=t==this.debug?1:t==this.info?2:t==this.warn?3:(this.error,4)},debug:function(t,e){void 0===console.debug&&(console.debug=console.log),1>=o&&console.debug("["+d.getDurationString(new Date-n,1e3)+"]","["+t+"]",e)},log:function(t,e){this.debug(t.msg)},info:function(t,e){2>=o&&console.info("["+d.getDurationString(new Date-n,1e3)+"]","["+t+"]",e)},warn:function(t,e){3>=o&&console.warn("["+d.getDurationString(new Date-n,1e3)+"]","["+t+"]",e)},error:function(t,e){4>=o&&console.error("["+d.getDurationString(new Date-n,1e3)+"]","["+t+"]",e)}},h);d.getDurationString=function(t,e){var r;function n(t,e){for(var a=(""+t).split(".");a[0].length<e;)a[0]="0"+a[0];return a.join(".")}t<0?(r=!0,t=-t):r=!1;var o=t/(e||1),h=Math.floor(o/3600);o-=3600*h;var d=Math.floor(o/60),l=1e3*(o-=60*d);return l-=1e3*(o=Math.floor(o)),l=Math.floor(l),(r?"-":"")+h+":"+n(d,2)+":"+n(o,2)+"."+n(l,3)},d.printRanges=function(t){var e=t.length;if(e>0){for(var r="",i=0;i<e;i++)i>0&&(r+=","),r+="["+d.getDurationString(t.start(i))+","+d.getDurationString(t.end(i))+"]";return r}return"(empty)"},e.Log=d;var l=function(t){if(!(t instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=t,this.dataview=new DataView(t),this.position=0};l.prototype.getPosition=function(){return this.position},l.prototype.getEndPosition=function(){return this.buffer.byteLength},l.prototype.getLength=function(){return this.buffer.byteLength},l.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},l.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},l.prototype.readAnyInt=function(t,e){var r=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:r=e?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:r=e?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";r=this.dataview.getUint8(this.position)<<16,r|=this.dataview.getUint8(this.position+1)<<8,r|=this.dataview.getUint8(this.position+2);break;case 4:r=e?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";r=this.dataview.getUint32(this.position)<<32,r|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,r}throw"Not enough bytes in buffer"},l.prototype.readUint8=function(){return this.readAnyInt(1,!1)},l.prototype.readUint16=function(){return this.readAnyInt(2,!1)},l.prototype.readUint24=function(){return this.readAnyInt(3,!1)},l.prototype.readUint32=function(){return this.readAnyInt(4,!1)},l.prototype.readUint64=function(){return this.readAnyInt(8,!1)},l.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var s="",i=0;i<t;i++)s+=String.fromCharCode(this.readUint8());return s}throw"Not enough bytes in buffer"},l.prototype.readCString=function(){for(var t=[];;){var b=this.readUint8();if(0===b)break;t.push(b)}return String.fromCharCode.apply(null,t)},l.prototype.readInt8=function(){return this.readAnyInt(1,!0)},l.prototype.readInt16=function(){return this.readAnyInt(2,!0)},l.prototype.readInt32=function(){return this.readAnyInt(4,!0)},l.prototype.readInt64=function(){return this.readAnyInt(8,!1)},l.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readUint8();return e},l.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readInt16();return e},l.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readUint16();return e},l.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUint32();return e},l.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=this.readInt32();return e},e.MP4BoxStream=l;var f=function(t,e,r){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:"object"==typeof t?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==r?f.LITTLE_ENDIAN:r};f.prototype={},f.prototype.getPosition=function(){return this.position},f.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,r=this._buffer.byteLength;if(e<=r)e>this._byteLength&&(this._byteLength=e);else{for(r<1&&(r=1);e>r;)r*=2;var n=new ArrayBuffer(r),o=new Uint8Array(this._buffer);new Uint8Array(n,0,o.length).set(o),this.buffer=n,this._byteLength=e}}},f.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),r=new Uint8Array(this._buffer,0,e.length);e.set(r),this.buffer=t}},f.BIG_ENDIAN=!1,f.LITTLE_ENDIAN=!0,f.prototype._byteLength=0,Object.defineProperty(f.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(f.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),f.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},f.prototype.isEof=function(){return this.position>=this._byteLength},f.prototype.mapUint8Array=function(t){this._realloc(1*t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},f.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Int32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var r=new Int16Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Uint32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var r=new Uint16Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var r=new Float64Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Float32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},f.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,e},f.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,e},f.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},f.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,e},f.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,e},f.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},f.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,e},f.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,e},f.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,f.memcpy=function(t,e,r,n,o){var h=new Uint8Array(t,e,o),d=new Uint8Array(r,n,o);h.set(d)},f.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},f.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},f.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var r=i+t.BYTES_PER_ELEMENT-1,n=i;r>n;r--,n++){var o=e[n];e[n]=e[r],e[r]=o}return t},f.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)},f.prototype.readString=function(t,e){return null==e||"ASCII"==e?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==t?this.byteLength-this.position:t)]):new TextDecoder(e).decode(this.mapUint8Array(t))},f.prototype.readCString=function(t){var e=this.byteLength-this.position,r=new Uint8Array(this._buffer,this._byteOffset+this.position),n=e;null!=t&&(n=Math.min(t,e));for(var i=0;i<n&&0!==r[i];i++);var s=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(i)]);return null!=t?this.position+=n-i:i!=e&&(this.position+=1),s};var _=Math.pow(2,32);f.prototype.readInt64=function(){return this.readInt32()*_+this.readUint32()},f.prototype.readUint64=function(){return this.readUint32()*_+this.readUint32()},f.prototype.readInt64=function(){return this.readUint32()*_+this.readUint32()},f.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},e.DataStream=f,f.prototype.save=function(t){var e=new Blob([this.buffer]);if(!window.URL||!URL.createObjectURL)throw"DataStream.save: Can't create object URL.";var r=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.setAttribute("href",r),a.setAttribute("download",t),a.setAttribute("target","_self"),a.click(),window.URL.revokeObjectURL(r)},f.prototype._dynamicSize=!0,Object.defineProperty(f.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),f.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),r=new Uint8Array(e),n=new Uint8Array(this._buffer,t,r.length);r.set(n),this.buffer=e,this.position-=t},f.prototype.writeInt32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)},f.prototype.writeInt16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)},f.prototype.writeInt8Array=function(t){if(this._realloc(1*t.length),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var i=0;i<t.length;i++)this.writeInt8(t[i])},f.prototype.writeUint32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)},f.prototype.writeUint16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)},f.prototype.writeUint8Array=function(t){if(this._realloc(1*t.length),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var i=0;i<t.length;i++)this.writeUint8(t[i])},f.prototype.writeFloat64Array=function(t,e){if(this._realloc(8*t.length),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)},f.prototype.writeFloat32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)},f.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,null==e?this.endianness:e),this.position+=4},f.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,null==e?this.endianness:e),this.position+=2},f.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},f.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,null==e?this.endianness:e),this.position+=4},f.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,null==e?this.endianness:e),this.position+=2},f.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},f.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,null==e?this.endianness:e),this.position+=4},f.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,null==e?this.endianness:e),this.position+=8},f.prototype.writeUCS2String=function(t,e,r){null==r&&(r=t.length);for(var i=0;i<t.length&&i<r;i++)this.writeUint16(t.charCodeAt(i),e);for(;i<r;i++)this.writeUint16(0)},f.prototype.writeString=function(s,t,e){var i=0;if(null==t||"ASCII"==t)if(null!=e){var r=Math.min(s.length,e);for(i=0;i<r;i++)this.writeUint8(s.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else for(i=0;i<s.length;i++)this.writeUint8(s.charCodeAt(i));else this.writeUint8Array(new TextEncoder(t).encode(s.substring(0,e)))},f.prototype.writeCString=function(s,t){var i=0;if(null!=t){var e=Math.min(s.length,t);for(i=0;i<e;i++)this.writeUint8(s.charCodeAt(i));for(;i<t;i++)this.writeUint8(0)}else{for(i=0;i<s.length;i++)this.writeUint8(s.charCodeAt(i));this.writeUint8(0)}},f.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var r=t[i+1];this.writeType(r,e[t[i]],e)}},f.prototype.writeType=function(t,e,r){var n;if("function"==typeof t)return t(this,e);if("object"==typeof t&&!(t instanceof Array))return t.set(this,e,r);var o=null,h="ASCII",d=this.position;switch("string"==typeof t&&/:/.test(t)&&(n=t.split(":"),t=n[0],o=parseInt(n[1])),"string"==typeof t&&/,/.test(t)&&(n=t.split(","),t=n[0],h=parseInt(n[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,f.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,f.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,f.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,f.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,f.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,f.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,f.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,f.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,f.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,f.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,f.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,f.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,o);break;case"string":this.writeString(e,h,o);break;case"u16string":this.writeUCS2String(e,this.endianness,o);break;case"u16stringle":this.writeUCS2String(e,f.LITTLE_ENDIAN,o);break;case"u16stringbe":this.writeUCS2String(e,f.BIG_ENDIAN,o);break;default:if(3==t.length){for(var l=t[1],i=0;i<e.length;i++)this.writeType(l,e[i]);break}this.writeStruct(t,e)}null!=o&&(this.position=d,this._realloc(o),this.position=d+o)},f.prototype.writeUint64=function(t){var e=Math.floor(t/_);this.writeUint32(e),this.writeUint32(4294967295&t)},f.prototype.writeUint24=function(t){this.writeUint8((16711680&t)>>16),this.writeUint8((65280&t)>>8),this.writeUint8(255&t)},f.prototype.adjustUint32=function(t,e){var r=this.position;this.seek(t),this.writeUint32(e),this.seek(r)},f.prototype.mapInt32Array=function(t,e){this._realloc(4*t);var r=new Int32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r},f.prototype.mapInt16Array=function(t,e){this._realloc(2*t);var r=new Int16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=2*t,r},f.prototype.mapInt8Array=function(t){this._realloc(1*t);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},f.prototype.mapUint32Array=function(t,e){this._realloc(4*t);var r=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r},f.prototype.mapUint16Array=function(t,e){this._realloc(2*t);var r=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=2*t,r},f.prototype.mapFloat64Array=function(t,e){this._realloc(8*t);var r=new Float64Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=8*t,r},f.prototype.mapFloat32Array=function(t,e){this._realloc(4*t);var r=new Float32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r};var c=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};(c.prototype=new f(new ArrayBuffer,0,f.BIG_ENDIAN)).initialized=function(){var t;return this.bufferIndex>-1||(this.buffers.length>0?0===(t=this.buffers[0]).fileStart?(this.buffer=t,this.bufferIndex=0,d.debug("MultiBufferStream","Stream ready for parsing"),!0):(d.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1):(d.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(t,e){d.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t),0),r.set(new Uint8Array(e),t.byteLength),r.buffer},c.prototype.reduceBuffer=function(t,e,r){var n;return(n=new Uint8Array(r)).set(new Uint8Array(t,e,r)),n.buffer.fileStart=t.fileStart+e,n.buffer.usedBytes=0,n.buffer},c.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var b=this.buffers[i];if(t.fileStart<=b.fileStart){if(t.fileStart===b.fileStart){if(t.byteLength>b.byteLength){this.buffers.splice(i,1),i--;continue}d.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=b.fileStart||(t=this.reduceBuffer(t,0,b.fileStart-t.fileStart)),d.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),0===i&&(this.buffer=t);e=!1;break}if(t.fileStart<b.fileStart+b.byteLength){var r=b.fileStart+b.byteLength-t.fileStart,n=t.byteLength-r;if(!(n>0)){e=!1;break}t=this.reduceBuffer(t,r,n)}}e&&(d.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),0===i&&(this.buffer=t))},c.prototype.logBufferLevel=function(t){var i,e,r,n,o,h=[],l="";for(r=0,n=0,i=0;i<this.buffers.length;i++)e=this.buffers[i],0===i?(o={},h.push(o),o.start=e.fileStart,o.end=e.fileStart+e.byteLength,l+="["+o.start+"-"):o.end===e.fileStart?o.end=e.fileStart+e.byteLength:((o={}).start=e.fileStart,l+=h[h.length-1].end-1+"], ["+o.start+"-",o.end=e.fileStart+e.byteLength,h.push(o)),r+=e.usedBytes,n+=e.byteLength;h.length>0&&(l+=o.end-1+"]");var f=t?d.info:d.debug;0===this.buffers.length?f("MultiBufferStream","No more buffer in memory"):f("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+r+"/"+n+" bytes), continuous ranges: "+l)},c.prototype.cleanBuffers=function(){var i,t;for(i=0;i<this.buffers.length;i++)(t=this.buffers[i]).usedBytes===t.byteLength&&(d.debug("MultiBufferStream","Removing buffer #"+i),this.buffers.splice(i,1),i--)},c.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length){if((t=this.buffers[this.bufferIndex+1]).fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,r=this.buffer.usedBytes,n=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=r,this.buffer.fileStart=n,d.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}return!1}return!1},c.prototype.findPosition=function(t,e,r){var i,n=null,o=-1;for(i=!0===t?0:this.bufferIndex;i<this.buffers.length&&(n=this.buffers[i]).fileStart<=e;)o=i,r&&(n.fileStart+n.byteLength<=e?n.usedBytes=n.byteLength:n.usedBytes=e-n.fileStart,this.logBufferLevel()),i++;return-1!==o&&(n=this.buffers[o]).fileStart+n.byteLength>=e?(d.debug("MultiBufferStream","Found position in existing buffer #"+o),o):-1},c.prototype.findEndContiguousBuf=function(t){var i,e,r,n=void 0!==t?t:this.bufferIndex;if(e=this.buffers[n],this.buffers.length>n+1)for(i=n+1;i<this.buffers.length&&(r=this.buffers[i]).fileStart===e.fileStart+e.byteLength;i++)e=r;return e.fileStart+e.byteLength},c.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return-1!==e?this.findEndContiguousBuf(e):t},c.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},c.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},c.prototype.seek=function(t,e,r){var n;return-1!==(n=this.findPosition(e,t,r))?(this.buffer=this.buffers[n],this.bufferIndex=n,this.position=t-this.buffer.fileStart,d.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(d.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},c.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},c.prototype.getLength=function(){return this.byteLength},c.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},e.MultiBufferStream=c;var m=function(){var t=[];t[3]="ES_Descriptor",t[4]="DecoderConfigDescriptor",t[5]="DecoderSpecificInfo",t[6]="SLConfigDescriptor",this.getDescriptorName=function(e){return t[e]};var e=this,r={};return this.parseOneDescriptor=function(e){var n,desc,o,h=0;for(n=e.readUint8(),o=e.readUint8();128&o;)h=(127&o)<<7,o=e.readUint8();return h+=127&o,d.debug("MPEG4DescriptorParser","Found "+(t[n]||"Descriptor "+n)+", size "+h+" at position "+e.getPosition()),(desc=t[n]?new r[t[n]](h):new r.Descriptor(h)).parse(e),desc},r.Descriptor=function(t,e){this.tag=t,this.size=e,this.descs=[]},r.Descriptor.prototype.parse=function(t){this.data=t.readUint8Array(this.size)},r.Descriptor.prototype.findDescriptor=function(t){for(var i=0;i<this.descs.length;i++)if(this.descs[i].tag==t)return this.descs[i];return null},r.Descriptor.prototype.parseRemainingDescriptors=function(t){for(var r=t.position;t.position<r+this.size;){var desc=e.parseOneDescriptor(t);this.descs.push(desc)}},r.ES_Descriptor=function(t){r.Descriptor.call(this,3,t)},r.ES_Descriptor.prototype=new r.Descriptor,r.ES_Descriptor.prototype.parse=function(t){if(this.ES_ID=t.readUint16(),this.flags=t.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=t.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var e=t.readUint8();this.URL=t.readString(e),this.size-=e+1}else this.URL="";32&this.flags?(this.OCR_ES_ID=t.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(t)},r.ES_Descriptor.prototype.getOTI=function(t){var e=this.findDescriptor(4);return e?e.oti:0},r.ES_Descriptor.prototype.getAudioConfig=function(t){var e=this.findDescriptor(4);if(!e)return null;var r=e.findDescriptor(5);if(r&&r.data){var n=(248&r.data[0])>>3;return 31===n&&r.data.length>=2&&(n=32+((7&r.data[0])<<3)+((224&r.data[1])>>5)),n}return null},r.DecoderConfigDescriptor=function(t){r.Descriptor.call(this,4,t)},r.DecoderConfigDescriptor.prototype=new r.Descriptor,r.DecoderConfigDescriptor.prototype.parse=function(t){this.oti=t.readUint8(),this.streamType=t.readUint8(),this.bufferSize=t.readUint24(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32(),this.size-=13,this.parseRemainingDescriptors(t)},r.DecoderSpecificInfo=function(t){r.Descriptor.call(this,5,t)},r.DecoderSpecificInfo.prototype=new r.Descriptor,r.SLConfigDescriptor=function(t){r.Descriptor.call(this,6,t)},r.SLConfigDescriptor.prototype=new r.Descriptor,this};e.MPEG4DescriptorParser=m;var y={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){y.FullBox.prototype=new y.Box,y.ContainerBox.prototype=new y.Box,y.SampleEntry.prototype=new y.Box,y.TrackGroupTypeBox.prototype=new y.FullBox,y.BASIC_BOXES.forEach((function(t){y.createBoxCtor(t)})),y.FULL_BOXES.forEach((function(t){y.createFullBoxCtor(t)})),y.CONTAINER_BOXES.forEach((function(t){y.createContainerBoxCtor(t[0],null,t[1])}))},Box:function(t,e,r){this.type=t,this.size=e,this.uuid=r},FullBox:function(t,e,r){y.Box.call(this,t,e,r),this.flags=0,this.version=0},ContainerBox:function(t,e,r){y.Box.call(this,t,e,r),this.boxes=[]},SampleEntry:function(t,e,r,n){y.ContainerBox.call(this,t,e),this.hdr_size=r,this.start=n},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){y.FullBox.call(this,t,e)},createBoxCtor:function(t,e){y.boxCodes.push(t),y[t+"Box"]=function(e){y.Box.call(this,t,e)},y[t+"Box"].prototype=new y.Box,e&&(y[t+"Box"].prototype.parse=e)},createFullBoxCtor:function(t,e){y[t+"Box"]=function(e){y.FullBox.call(this,t,e)},y[t+"Box"].prototype=new y.FullBox,y[t+"Box"].prototype.parse=function(t){this.parseFullHeader(t),e&&e.call(this,t)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,r=0;r<e;r++)this[t[r]+"s"]=[]}},createContainerBoxCtor:function(t,e,r){y[t+"Box"]=function(e){y.ContainerBox.call(this,t,e),y.addSubBoxArrays.call(this,r)},y[t+"Box"].prototype=new y.ContainerBox,e&&(y[t+"Box"].prototype.parse=e)},createMediaSampleEntryCtor:function(t,e,r){y.sampleEntryCodes[t]=[],y[t+"SampleEntry"]=function(t,e){y.SampleEntry.call(this,t,e),y.addSubBoxArrays.call(this,r)},y[t+"SampleEntry"].prototype=new y.SampleEntry,e&&(y[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,r,n){y.sampleEntryCodes[t].push(e),y[e+"SampleEntry"]=function(r){y[t+"SampleEntry"].call(this,e,r),y.addSubBoxArrays.call(this,n)},y[e+"SampleEntry"].prototype=new y[t+"SampleEntry"],r&&(y[e+"SampleEntry"].prototype.parse=r)},createEncryptedSampleEntryCtor:function(t,e,r){y.createSampleEntryCtor.call(this,t,e,r,["sinf"])},createSampleGroupCtor:function(t,e){y[t+"SampleGroupEntry"]=function(e){y.SampleGroupEntry.call(this,t,e)},y[t+"SampleGroupEntry"].prototype=new y.SampleGroupEntry,e&&(y[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){y[t+"TrackGroupTypeBox"]=function(e){y.TrackGroupTypeBox.call(this,t,e)},y[t+"TrackGroupTypeBox"].prototype=new y.TrackGroupTypeBox,e&&(y[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,r,n){y.UUIDs.push(t),y.UUIDBoxes[t]=function(n){e?y.FullBox.call(this,"uuid",n,t):r?y.ContainerBox.call(this,"uuid",n,t):y.Box.call(this,"uuid",n,t)},y.UUIDBoxes[t].prototype=e?new y.FullBox:r?new y.ContainerBox:new y.Box,n&&(y.UUIDBoxes[t].prototype.parse=e?function(t){this.parseFullHeader(t),n&&n.call(this,t)}:n)}};y.initialize(),y.TKHD_FLAG_ENABLED=1,y.TKHD_FLAG_IN_MOVIE=2,y.TKHD_FLAG_IN_PREVIEW=4,y.TFHD_FLAG_BASE_DATA_OFFSET=1,y.TFHD_FLAG_SAMPLE_DESC=2,y.TFHD_FLAG_SAMPLE_DUR=8,y.TFHD_FLAG_SAMPLE_SIZE=16,y.TFHD_FLAG_SAMPLE_FLAGS=32,y.TFHD_FLAG_DUR_EMPTY=65536,y.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,y.TRUN_FLAGS_DATA_OFFSET=1,y.TRUN_FLAGS_FIRST_FLAG=4,y.TRUN_FLAGS_DURATION=256,y.TRUN_FLAGS_SIZE=512,y.TRUN_FLAGS_FLAGS=1024,y.TRUN_FLAGS_CTS_OFFSET=2048,y.Box.prototype.add=function(t){return this.addBox(new y[t+"Box"])},y.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},y.Box.prototype.set=function(t,e){return this[t]=e,this},y.Box.prototype.addEntry=function(t,e){var r=e||"entries";return this[r]||(this[r]=[]),this[r].push(t),this},e.BoxParser=y,y.parseUUID=function(t){return y.parseHex16(t)},y.parseHex16=function(t){for(var e="",i=0;i<16;i++){var r=t.readUint8().toString(16);e+=1===r.length?"0"+r:r}return e},y.parseOneBox=function(t,e,r){var n,o,h,l=t.getPosition(),f=0;if(t.getEndPosition()-l<8)return d.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:y.ERR_NOT_ENOUGH_DATA};if(r&&r<8)return d.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:y.ERR_NOT_ENOUGH_DATA};var _=t.readUint32(),c=t.readString(4),m=c;if(d.debug("BoxParser","Found box of type '"+c+"' and size "+_+" at position "+l),f=8,"uuid"==c){if(t.getEndPosition()-t.getPosition()<16||r-f<16)return t.seek(l),d.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:y.ERR_NOT_ENOUGH_DATA};f+=16,m=h=y.parseUUID(t)}if(1==_){if(t.getEndPosition()-t.getPosition()<8||r&&r-f<8)return t.seek(l),d.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+c+'" box'),{code:y.ERR_NOT_ENOUGH_DATA};_=t.readUint64(),f+=8}else if(0===_)if(r)_=r;else if("mdat"!==c)return d.error("BoxParser","Unlimited box size not supported for type: '"+c+"'"),n=new y.Box(c,_),{code:y.OK,box:n,size:n.size};return 0!==_&&_<f?(d.error("BoxParser","Box of type "+c+" has an invalid size "+_+" (too small to be a box)"),{code:y.ERR_NOT_ENOUGH_DATA,type:c,size:_,hdr_size:f,start:l}):0!==_&&r&&_>r?(d.error("BoxParser","Box of type '"+c+"' has a size "+_+" greater than its container size "+r),{code:y.ERR_NOT_ENOUGH_DATA,type:c,size:_,hdr_size:f,start:l}):0!==_&&l+_>t.getEndPosition()?(t.seek(l),d.info("BoxParser","Not enough data in stream to parse the entire '"+c+"' box"),{code:y.ERR_NOT_ENOUGH_DATA,type:c,size:_,hdr_size:f,start:l}):e?{code:y.OK,type:c,size:_,hdr_size:f,start:l}:(y[c+"Box"]?n=new y[c+"Box"](_):"uuid"!==c?(d.warn("BoxParser","Unknown box type: '"+c+"'"),(n=new y.Box(c,_)).has_unparsed_data=!0):y.UUIDBoxes[h]?n=new y.UUIDBoxes[h](_):(d.warn("BoxParser","Unknown uuid type: '"+h+"'"),(n=new y.Box(c,_)).uuid=h,n.has_unparsed_data=!0),n.hdr_size=f,n.start=l,n.write===y.Box.prototype.write&&"mdat"!==n.type&&(d.info("BoxParser","'"+m+"' box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),(o=t.getPosition()-(n.start+n.size))<0?(d.warn("BoxParser","Parsing of box '"+m+"' did not read the entire indicated box data size (missing "+-o+" bytes), seeking forward"),t.seek(n.start+n.size)):o>0&&(d.error("BoxParser","Parsing of box '"+m+"' read "+o+" more bytes than the indicated box data size, seeking backwards"),0!==n.size&&t.seek(n.start+n.size)),{code:y.OK,box:n,size:n.size})},y.Box.prototype.parse=function(t){"mdat"!=this.type?this.data=t.readUint8Array(this.size-this.hdr_size):0===this.size?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},y.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},y.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},y.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},y.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},y.ContainerBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;){if((e=y.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==y.OK)return;if(r=e.box,this.boxes.push(r),this.subBoxNames&&-1!=this.subBoxNames.indexOf(r.type))this[this.subBoxNames[this.subBoxNames.indexOf(r.type)]+"s"].push(r);else{var n="uuid"!==r.type?r.type:r.uuid;this[n]?d.warn("Box of type "+n+" already stored in field of this type"):this[n]=r}}},y.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=31&this.language,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},y.SAMPLE_ENTRY_TYPE_VISUAL="Visual",y.SAMPLE_ENTRY_TYPE_AUDIO="Audio",y.SAMPLE_ENTRY_TYPE_HINT="Hint",y.SAMPLE_ENTRY_TYPE_METADATA="Metadata",y.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",y.SAMPLE_ENTRY_TYPE_SYSTEM="System",y.SAMPLE_ENTRY_TYPE_TEXT="Text",y.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},y.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},y.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},y.SampleEntry.prototype.parseFooter=function(t){y.ContainerBox.prototype.parse.call(this,t)},y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_HINT),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_METADATA),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SYSTEM),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_TEXT),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,(function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)})),y.createMediaSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,(function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_TEXT,"enct"),y.createEncryptedSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_METADATA,"encm"),y.createBoxCtor("a1lx",(function(t){var e=16*(1+(1&(1&t.readUint8())));this.layer_size=[];for(var i=0;i<3;i++)this.layer_size[i]=16==e?t.readUint16():t.readUint32()})),y.createBoxCtor("a1op",(function(t){this.op_index=t.readUint8()})),y.createFullBoxCtor("auxC",(function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)})),y.createBoxCtor("av1C",(function(t){var e=t.readUint8();if(e>>7&!1)d.error("av1C marker problem");else if(this.version=127&e,1===this.version)if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=31&e,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=3&e,e=t.readUint8(),this.reserved_1=e>>5&7,0===this.reserved_1){if(this.initial_presentation_delay_present=e>>4&1,1===this.initial_presentation_delay_present)this.initial_presentation_delay_minus_one=15&e;else if(this.reserved_2=15&e,0!==this.reserved_2)return void d.error("av1C reserved_2 parsing problem");var r=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(r)}else d.error("av1C reserved_1 parsing problem");else d.error("av1C version "+this.version+" not supported")})),y.createBoxCtor("avcC",(function(t){var i,e;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=3&t.readUint8(),this.nb_SPS_nalus=31&t.readUint8(),e=this.size-this.hdr_size-6,this.SPS=[],i=0;i<this.nb_SPS_nalus;i++)this.SPS[i]={},this.SPS[i].length=t.readUint16(),this.SPS[i].nalu=t.readUint8Array(this.SPS[i].length),e-=2+this.SPS[i].length;for(this.nb_PPS_nalus=t.readUint8(),e--,this.PPS=[],i=0;i<this.nb_PPS_nalus;i++)this.PPS[i]={},this.PPS[i].length=t.readUint16(),this.PPS[i].nalu=t.readUint8Array(this.PPS[i].length),e-=2+this.PPS[i].length;e>0&&(this.ext=t.readUint8Array(e))})),y.createBoxCtor("btrt",(function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()})),y.createBoxCtor("clap",(function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()})),y.createBoxCtor("clli",(function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()})),y.createFullBoxCtor("co64",(function(t){var e,i;if(e=t.readUint32(),this.chunk_offsets=[],0===this.version)for(i=0;i<e;i++)this.chunk_offsets.push(t.readUint64())})),y.createFullBoxCtor("CoLL",(function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()})),y.createBoxCtor("colr",(function(t){if(this.colour_type=t.readString(4),"nclx"===this.colour_type){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else("rICC"===this.colour_type||"prof"===this.colour_type)&&(this.ICC_profile=t.readUint8Array(this.size-4))})),y.createFullBoxCtor("cprt",(function(t){this.parseLanguage(t),this.notice=t.readCString()})),y.createFullBoxCtor("cslg",(function(t){0===this.version&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())})),y.createFullBoxCtor("ctts",(function(t){var e,i;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],0===this.version)for(i=0;i<e;i++){this.sample_counts.push(t.readUint32());var r=t.readInt32();r<0&&d.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(r)}else if(1==this.version)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())})),y.createBoxCtor("dac3",(function(t){var e=t.readUint8(),r=t.readUint8(),n=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(1&e)<<2|r>>6&3,this.acmod=r>>3&7,this.lfeon=r>>2&1,this.bit_rate_code=3&r|n>>5&7})),y.createBoxCtor("dec3",(function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=7&e,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var r={};this.ind_subs.push(r);var n=t.readUint8(),o=t.readUint8(),h=t.readUint8();r.fscod=n>>6,r.bsid=n>>1&31,r.bsmod=(1&n)<<4|o>>4&15,r.acmod=o>>1&7,r.lfeon=1&o,r.num_dep_sub=h>>1&15,r.num_dep_sub>0&&(r.chan_loc=(1&h)<<8|t.readUint8())}})),y.createFullBoxCtor("dfLa",(function(t){var e=[],r=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];for(this.parseFullHeader(t);;){var n=t.readUint8(),o=Math.min(127&n,r.length-1);if(o?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),e.push(r[o]),128&n)break}this.numMetadataBlocks=e.length+" ("+e.join(", ")+")"})),y.createBoxCtor("dimm",(function(t){this.bytessent=t.readUint64()})),y.createBoxCtor("dmax",(function(t){this.time=t.readUint32()})),y.createBoxCtor("dmed",(function(t){this.bytessent=t.readUint64()})),y.createBoxCtor("dOps",(function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),0!==this.ChannelMappingFamily){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var i=0;i<this.OutputChannelCount;i++)this.ChannelMapping[i]=t.readUint8()}})),y.createFullBoxCtor("dref",(function(t){var e,r;this.entries=[];for(var n=t.readUint32(),i=0;i<n;i++){if((e=y.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==y.OK)return;r=e.box,this.entries.push(r)}})),y.createBoxCtor("drep",(function(t){this.bytessent=t.readUint64()})),y.createFullBoxCtor("elng",(function(t){this.extended_language=t.readString(this.size-this.hdr_size)})),y.createFullBoxCtor("elst",(function(t){this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),1===this.version?(r.segment_duration=t.readUint64(),r.media_time=t.readInt64()):(r.segment_duration=t.readUint32(),r.media_time=t.readInt32()),r.media_rate_integer=t.readInt16(),r.media_rate_fraction=t.readInt16()}})),y.createFullBoxCtor("emsg",(function(t){1==this.version?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));1==this.version&&(e-=4),this.message_data=t.readUint8Array(e)})),y.createFullBoxCtor("esds",(function(t){var e=t.readUint8Array(this.size-this.hdr_size),r=new m;this.esd=r.parseOneDescriptor(new f(e.buffer,0,f.BIG_ENDIAN))})),y.createBoxCtor("fiel",(function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()})),y.createBoxCtor("frma",(function(t){this.data_format=t.readString(4)})),y.createBoxCtor("ftyp",(function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;e>=4;)this.compatible_brands[i]=t.readString(4),e-=4,i++})),y.createFullBoxCtor("hdlr",(function(t){0===this.version&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1)))})),y.createBoxCtor("hvcC",(function(t){var i,e,r,n;this.configurationVersion=t.readUint8(),n=t.readUint8(),this.general_profile_space=n>>6,this.general_tier_flag=(32&n)>>5,this.general_profile_idc=31&n,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=4095&t.readUint16(),this.parallelismType=3&t.readUint8(),this.chroma_format_idc=3&t.readUint8(),this.bit_depth_luma_minus8=7&t.readUint8(),this.bit_depth_chroma_minus8=7&t.readUint8(),this.avgFrameRate=t.readUint16(),n=t.readUint8(),this.constantFrameRate=n>>6,this.numTemporalLayers=(13&n)>>3,this.temporalIdNested=(4&n)>>2,this.lengthSizeMinusOne=3&n,this.nalu_arrays=[];var o=t.readUint8();for(i=0;i<o;i++){var h=[];this.nalu_arrays.push(h),n=t.readUint8(),h.completeness=(128&n)>>7,h.nalu_type=63&n;var d=t.readUint16();for(e=0;e<d;e++){var l={};h.push(l),r=t.readUint16(),l.data=t.readUint8Array(r)}}})),y.createFullBoxCtor("iinf",(function(t){var e;0===this.version?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++){if((e=y.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==y.OK)return;"infe"!==e.box.type&&d.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[i]=e.box}})),y.createFullBoxCtor("iloc",(function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=15&e,e=t.readUint8(),this.base_offset_size=e>>4&15,1===this.version||2===this.version?this.index_size=15&e:this.index_size=0,this.items=[];var r=0;if(this.version<2)r=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";r=t.readUint32()}for(var i=0;i<r;i++){var n={};if(this.items.push(n),this.version<2)n.item_ID=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";n.item_ID=t.readUint16()}switch(1===this.version||2===this.version?n.construction_method=15&t.readUint16():n.construction_method=0,n.data_reference_index=t.readUint16(),this.base_offset_size){case 0:n.base_offset=0;break;case 4:n.base_offset=t.readUint32();break;case 8:n.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var o=t.readUint16();n.extents=[];for(var h=0;h<o;h++){var d={};if(n.extents.push(d),1===this.version||2===this.version)switch(this.index_size){case 0:d.extent_index=0;break;case 4:d.extent_index=t.readUint32();break;case 8:d.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:d.extent_offset=0;break;case 4:d.extent_offset=t.readUint32();break;case 8:d.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:d.extent_length=0;break;case 4:d.extent_length=t.readUint32();break;case 8:d.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}})),y.createBoxCtor("imir",(function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=1&e})),y.createFullBoxCtor("infe",(function(t){if(0!==this.version&&1!==this.version||(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),1===this.version)return this.extension_type=t.readString(4),d.warn("BoxParser","Cannot parse extension type"),void t.seek(this.start+this.size);this.version>=2&&(2===this.version?this.item_ID=t.readUint16():3===this.version&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),"mime"===this.item_type?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):"uri "===this.item_type&&(this.item_uri_type=t.readCString()))})),y.createFullBoxCtor("ipma",(function(t){var i,e;for(entry_count=t.readUint32(),this.associations=[],i=0;i<entry_count;i++){var r={};this.associations.push(r),this.version<1?r.id=t.readUint16():r.id=t.readUint32();var n=t.readUint8();for(r.props=[],e=0;e<n;e++){var o=t.readUint8(),p={};r.props.push(p),p.essential=(128&o)>>7==1,1&this.flags?p.property_index=(127&o)<<8|t.readUint8():p.property_index=127&o}}})),y.createFullBoxCtor("iref",(function(t){var e,r;for(this.references=[];t.getPosition()<this.start+this.size;){if((e=y.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==y.OK)return;(r=0===this.version?new y.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):new y.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start)).write===y.Box.prototype.write&&"mdat"!==r.type&&(d.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.references.push(r)}})),y.createBoxCtor("irot",(function(t){this.angle=3&t.readUint8()})),y.createFullBoxCtor("ispe",(function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()})),y.createFullBoxCtor("kind",(function(t){this.schemeURI=t.readCString(),this.value=t.readCString()})),y.createFullBoxCtor("leva",(function(t){var e=t.readUint8();this.levels=[];for(var i=0;i<e;i++){var r={};this.levels[i]=r,r.track_ID=t.readUint32();var n=t.readUint8();switch(r.padding_flag=n>>7,r.assignment_type=127&n,r.assignment_type){case 0:r.grouping_type=t.readString(4);break;case 1:r.grouping_type=t.readString(4),r.grouping_type_parameter=t.readUint32();break;case 2:case 3:break;case 4:r.sub_track_id=t.readUint32();break;default:d.warn("BoxParser","Unknown leva assignement type")}}})),y.createBoxCtor("lsel",(function(t){this.layer_id=t.readUint16()})),y.createBoxCtor("maxr",(function(t){this.period=t.readUint32(),this.bytes=t.readUint32()})),y.createBoxCtor("mdcv",(function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()})),y.createFullBoxCtor("mdhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()})),y.createFullBoxCtor("mehd",(function(t){1&this.flags&&(d.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),1==this.version?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()})),y.createFullBoxCtor("meta",(function(t){this.boxes=[],y.ContainerBox.prototype.parse.call(this,t)})),y.createFullBoxCtor("mfhd",(function(t){this.sequence_number=t.readUint32()})),y.createFullBoxCtor("mfro",(function(t){this._size=t.readUint32()})),y.createFullBoxCtor("mvhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()})),y.createBoxCtor("npck",(function(t){this.packetssent=t.readUint32()})),y.createBoxCtor("nump",(function(t){this.packetssent=t.readUint64()})),y.createFullBoxCtor("padb",(function(t){var e=t.readUint32();this.padbits=[];for(var i=0;i<Math.floor((e+1)/2);i++)this.padbits=t.readUint8()})),y.createBoxCtor("pasp",(function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()})),y.createBoxCtor("payl",(function(t){this.text=t.readString(this.size-this.hdr_size)})),y.createBoxCtor("payt",(function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)})),y.createFullBoxCtor("pdin",(function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<e;i++)this.rate[i]=t.readUint32(),this.initial_delay[i]=t.readUint32()})),y.createFullBoxCtor("pitm",(function(t){0===this.version?this.item_id=t.readUint16():this.item_id=t.readUint32()})),y.createFullBoxCtor("pixi",(function(t){var i;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],i=0;i<this.num_channels;i++)this.bits_per_channels[i]=t.readUint8()})),y.createBoxCtor("pmax",(function(t){this.bytes=t.readUint32()})),y.createFullBoxCtor("prft",(function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),0===this.version?this.media_time=t.readUint32():this.media_time=t.readUint64()})),y.createFullBoxCtor("pssh",(function(t){if(this.system_id=y.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var i=0;i<e;i++)this.kid[i]=y.parseHex16(t)}var r=t.readUint32();r>0&&(this.data=t.readUint8Array(r))})),y.createFullBoxCtor("clef",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),y.createFullBoxCtor("enof",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),y.createFullBoxCtor("prof",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),y.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),y.createBoxCtor("rtp ",(function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)})),y.createFullBoxCtor("saio",(function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var i=0;i<e;i++)0===this.version?this.offset[i]=t.readUint32():this.offset[i]=t.readUint64()})),y.createFullBoxCtor("saiz",(function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var i=0;i<e;i++)this.sample_info_size[i]=t.readUint8()})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_METADATA,"mett",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_METADATA,"metx",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",(function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",(function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)})),y.createSampleEntryCtor(y.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",(function(t){this.parseHeader(t),this.parseFooter(t)})),y.createSampleGroupCtor("alst",(function(t){var i,e=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],i=0;i<e;i++)this.sample_offset[i]=t.readUint32();var r=this.description_length-4-4*e;for(this.num_output_samples=[],this.num_total_samples=[],i=0;i<r/4;i++)this.num_output_samples[i]=t.readUint16(),this.num_total_samples[i]=t.readUint16()})),y.createSampleGroupCtor("avll",(function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()})),y.createSampleGroupCtor("avss",(function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var r=t.readUint8(),i=0;i<r;i++){var n={};this.dependency.push(n),n.subSeqDirectionFlag=t.readUint8(),n.layerNumber=t.readUint8(),n.subSequenceIdentifier=t.readUint16()}})),y.createSampleGroupCtor("dtrt",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("mvif",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("prol",(function(t){this.roll_distance=t.readInt16()})),y.createSampleGroupCtor("rap ",(function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=127&e})),y.createSampleGroupCtor("rash",(function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)d.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var i=0;i<this.operation_point_count;i++)this.available_bitrate[i]=t.readUint32(),this.target_rate_share[i]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}})),y.createSampleGroupCtor("roll",(function(t){this.roll_distance=t.readInt16()})),y.SampleGroupEntry.prototype.parse=function(t){d.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},y.createSampleGroupCtor("scif",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("scnm",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("seig",(function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=15&e,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=y.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,1===this.isProtected&&0===this.Per_Sample_IV_Size&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))})),y.createSampleGroupCtor("stsa",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("sync",(function(t){var e=t.readUint8();this.NAL_unit_type=63&e})),y.createSampleGroupCtor("tele",(function(t){var e=t.readUint8();this.level_independently_decodable=e>>7})),y.createSampleGroupCtor("tsas",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("tscl",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createSampleGroupCtor("vipr",(function(t){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),y.createFullBoxCtor("sbgp",(function(t){this.grouping_type=t.readString(4),1===this.version?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),r.sample_count=t.readInt32(),r.group_description_index=t.readInt32()}})),y.createFullBoxCtor("schm",(function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),1&this.flags&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))})),y.createBoxCtor("sdp ",(function(t){this.sdptext=t.readString(this.size-this.hdr_size)})),y.createFullBoxCtor("sdtp",(function(t){var e,r=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var i=0;i<r;i++)e=t.readUint8(),this.is_leading[i]=e>>6,this.sample_depends_on[i]=e>>4&3,this.sample_is_depended_on[i]=e>>2&3,this.sample_has_redundancy[i]=3&e})),y.createFullBoxCtor("senc"),y.createFullBoxCtor("sgpd",(function(t){this.grouping_type=t.readString(4),d.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r;r=y[this.grouping_type+"SampleGroupEntry"]?new y[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new y.SampleGroupEntry(this.grouping_type),this.entries.push(r),1===this.version&&0===this.default_length?r.description_length=t.readUint32():r.description_length=this.default_length,r.write===y.SampleGroupEntry.prototype.write&&(d.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),r.data=t.readUint8Array(r.description_length),t.position-=r.description_length),r.parse(t)}})),y.createFullBoxCtor("sidx",(function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),i=0;i<e;i++){var r={};this.references.push(r);var n=t.readUint32();r.reference_type=n>>31&1,r.referenced_size=2147483647&n,r.subsegment_duration=t.readUint32(),n=t.readUint32(),r.starts_with_SAP=n>>31&1,r.SAP_type=n>>28&7,r.SAP_delta_time=268435455&n}})),y.SingleItemTypeReferenceBox=function(t,e,r,n){y.Box.call(this,t,e),this.hdr_size=r,this.start=n},y.SingleItemTypeReferenceBox.prototype=new y.Box,y.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint16()},y.SingleItemTypeReferenceBoxLarge=function(t,e,r,n){y.Box.call(this,t,e),this.hdr_size=r,this.start=n},y.SingleItemTypeReferenceBoxLarge.prototype=new y.Box,y.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint32()},y.createFullBoxCtor("SmDm",(function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()})),y.createFullBoxCtor("smhd",(function(t){this.balance=t.readUint16(),t.readUint16()})),y.createFullBoxCtor("ssix",(function(t){this.subsegments=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.subsegments.push(r),r.ranges=[];for(var n=t.readUint32(),o=0;o<n;o++){var h={};r.ranges.push(h),h.level=t.readUint8(),h.range_size=t.readUint24()}}})),y.createFullBoxCtor("stco",(function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],0===this.version)for(var i=0;i<e;i++)this.chunk_offsets.push(t.readUint32())})),y.createFullBoxCtor("stdp",(function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<e;i++)this.priority[i]=t.readUint16()})),y.createFullBoxCtor("sthd"),y.createFullBoxCtor("stri",(function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()})),y.createFullBoxCtor("stsc",(function(t){var e,i;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(i=0;i<e;i++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())})),y.createFullBoxCtor("stsd",(function(t){var i,e,r,n;for(this.entries=[],r=t.readUint32(),i=1;i<=r;i++){if((e=y.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==y.OK)return;y[e.type+"SampleEntry"]?((n=new y[e.type+"SampleEntry"](e.size)).hdr_size=e.hdr_size,n.start=e.start):(d.warn("BoxParser","Unknown sample entry type: "+e.type),n=new y.SampleEntry(e.type,e.size,e.hdr_size,e.start)),n.write===y.SampleEntry.prototype.write&&(d.info("BoxParser","SampleEntry "+n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.entries.push(n)}})),y.createFullBoxCtor("stsg",(function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var i=0;i<e;i++)this.group_description_index[i]=t.readUint32()})),y.createFullBoxCtor("stsh",(function(t){var e,i;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(i=0;i<e;i++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())})),y.createFullBoxCtor("stss",(function(t){var i,e;if(e=t.readUint32(),0===this.version)for(this.sample_numbers=[],i=0;i<e;i++)this.sample_numbers.push(t.readUint32())})),y.createFullBoxCtor("stsz",(function(t){var i;if(this.sample_sizes=[],0===this.version)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),i=0;i<this.sample_count;i++)0===this.sample_size?this.sample_sizes.push(t.readUint32()):this.sample_sizes[i]=this.sample_size})),y.createFullBoxCtor("stts",(function(t){var e,i,r;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],0===this.version)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),(r=t.readInt32())<0&&(d.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),r=1),this.sample_deltas.push(r)})),y.createFullBoxCtor("stvi",(function(t){var e=t.readUint32();this.single_view_allowed=3&e,this.stereo_scheme=t.readUint32();var r,n,o=t.readUint32();for(this.stereo_indication_type=t.readString(o),this.boxes=[];t.getPosition()<this.start+this.size;){if((r=y.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==y.OK)return;n=r.box,this.boxes.push(n),this[n.type]=n}})),y.createBoxCtor("styp",(function(t){y.ftypBox.prototype.parse.call(this,t)})),y.createFullBoxCtor("stz2",(function(t){var i,e;if(this.sample_sizes=[],0===this.version)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),e=t.readUint32(),4===this.field_size)for(i=0;i<e;i+=2){var r=t.readUint8();this.sample_sizes[i]=r>>4&15,this.sample_sizes[i+1]=15&r}else if(8===this.field_size)for(i=0;i<e;i++)this.sample_sizes[i]=t.readUint8();else if(16===this.field_size)for(i=0;i<e;i++)this.sample_sizes[i]=t.readUint16();else d.error("BoxParser","Error in length field in stz2 box")})),y.createFullBoxCtor("subs",(function(t){var i,e,r,n;for(r=t.readUint32(),this.entries=[],i=0;i<r;i++){var o={};if(this.entries[i]=o,o.sample_delta=t.readUint32(),o.subsamples=[],(n=t.readUint16())>0)for(e=0;e<n;e++){var h={};o.subsamples.push(h),1==this.version?h.size=t.readUint32():h.size=t.readUint16(),h.priority=t.readUint8(),h.discardable=t.readUint8(),h.codec_specific_parameters=t.readUint32()}}})),y.createFullBoxCtor("tenc",(function(t){if(t.readUint8(),0===this.version)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=15&e}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=y.parseHex16(t),1===this.default_isProtected&&0===this.default_Per_Sample_IV_Size&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))})),y.createFullBoxCtor("tfdt",(function(t){1==this.version?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()})),y.createFullBoxCtor("tfhd",(function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&y.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&y.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&y.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&y.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&y.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0})),y.createFullBoxCtor("tfra",(function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=3&e,this.entries=[];for(var r=t.readUint32(),i=0;i<r;i++)1===this.version?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()})),y.createFullBoxCtor("tkhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()})),y.createBoxCtor("tmax",(function(t){this.time=t.readUint32()})),y.createBoxCtor("tmin",(function(t){this.time=t.readUint32()})),y.createBoxCtor("totl",(function(t){this.bytessent=t.readUint32()})),y.createBoxCtor("tpay",(function(t){this.bytessent=t.readUint32()})),y.createBoxCtor("tpyl",(function(t){this.bytessent=t.readUint64()})),y.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},y.createTrackGroupCtor("msrc"),y.TrackReferenceTypeBox=function(t,e,r,n){y.Box.call(this,t,e),this.hdr_size=r,this.start=n},y.TrackReferenceTypeBox.prototype=new y.Box,y.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},y.trefBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;){if((e=y.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==y.OK)return;(r=new y.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start)).write===y.Box.prototype.write&&"mdat"!==r.type&&(d.info("BoxParser","TrackReference "+r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.boxes.push(r)}},y.createFullBoxCtor("trep",(function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;){if(ret=y.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code!==y.OK)return;box=ret.box,this.boxes.push(box)}})),y.createFullBoxCtor("trex",(function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()})),y.createBoxCtor("trpy",(function(t){this.bytessent=t.readUint64()})),y.createFullBoxCtor("trun",(function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&y.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&y.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&y.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&y.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&y.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&y.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())})),y.createFullBoxCtor("tsel",(function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()})),y.createFullBoxCtor("txtC",(function(t){this.config=t.readCString()})),y.createFullBoxCtor("url ",(function(t){1!==this.flags&&(this.location=t.readCString())})),y.createFullBoxCtor("urn ",(function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())})),y.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,(function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")})),y.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,(function(t){this.system_id=y.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))})),y.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),y.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,(function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=y.parseHex16(t)})),y.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,(function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var i=0;i<this.fragment_count;i++){var e={},r=0,n=0;1===this.version?(r=t.readUint64(),n=t.readUint64()):(r=t.readUint32(),n=t.readUint32()),e.absolute_time=r,e.absolute_duration=n,this.entries.push(e)}})),y.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,(function(t){1===this.version?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())})),y.createFullBoxCtor("vmhd",(function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)})),y.createFullBoxCtor("vpcC",(function(t){var e;1===this.version?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=1&e,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=15&e,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=1&e,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))})),y.createBoxCtor("vttC",(function(t){this.text=t.readString(this.size-this.hdr_size)})),y.createFullBoxCtor("vvcC",(function(t){var i,e,r={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(t){this.held_bits=t.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(t){this.held_bits=t.readUint16(),this.num_held_bits=16},extract_bits:function(t){var e=this.held_bits>>this.num_held_bits-t&(1<<t)-1;return this.num_held_bits-=t,e}};if(r.stream_read_1_bytes(t),r.extract_bits(5),this.lengthSizeMinusOne=r.extract_bits(2),this.ptl_present_flag=r.extract_bits(1),this.ptl_present_flag){if(r.stream_read_2_bytes(t),this.ols_idx=r.extract_bits(9),this.num_sublayers=r.extract_bits(3),this.constant_frame_rate=r.extract_bits(2),this.chroma_format_idc=r.extract_bits(2),r.stream_read_1_bytes(t),this.bit_depth_minus8=r.extract_bits(3),r.extract_bits(5),r.stream_read_2_bytes(t),r.extract_bits(2),this.num_bytes_constraint_info=r.extract_bits(6),this.general_profile_idc=r.extract_bits(7),this.general_tier_flag=r.extract_bits(1),this.general_level_idc=t.readUint8(),r.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=r.extract_bits(1),this.ptl_multilayer_enabled_flag=r.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(i=0;i<this.num_bytes_constraint_info-1;i++){var n=r.extract_bits(6);r.stream_read_1_bytes(t);var o=r.extract_bits(2);this.general_constraint_info[i]=n<<2|o}this.general_constraint_info[this.num_bytes_constraint_info-1]=r.extract_bits(6)}else r.extract_bits(6);for(r.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,e=this.num_sublayers-2;e>=0;--e){var h=r.extract_bits(1);this.ptl_sublayer_present_mask|=h<<e}for(e=this.num_sublayers;e<=8&&this.num_sublayers>1;++e)r.extract_bits(1);for(e=this.num_sublayers-2;e>=0;--e)this.ptl_sublayer_present_mask&1<<e&&(this.sublayer_level_idc[e]=t.readUint8());if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(i=0;i<this.ptl_num_sub_profiles;i++)this.general_sub_profile_idc.push(t.readUint32());this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}this.nalu_arrays=[];var d=t.readUint8();for(i=0;i<d;i++){var l=[];this.nalu_arrays.push(l),r.stream_read_1_bytes(t),l.completeness=r.extract_bits(1),r.extract_bits(2),l.nalu_type=r.extract_bits(5);var f=1;for(13!=l.nalu_type&&12!=l.nalu_type&&(f=t.readUint16()),e=0;e<f;e++){var _=t.readUint16();l.push({data:t.readUint8Array(_),length:_})}}})),y.createFullBoxCtor("vvnC",(function(t){var e=strm.readUint8();this.lengthSizeMinusOne=3&e})),y.SampleEntry.prototype.isVideo=function(){return!1},y.SampleEntry.prototype.isAudio=function(){return!1},y.SampleEntry.prototype.isSubtitle=function(){return!1},y.SampleEntry.prototype.isMetadata=function(){return!1},y.SampleEntry.prototype.isHint=function(){return!1},y.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},y.SampleEntry.prototype.getWidth=function(){return""},y.SampleEntry.prototype.getHeight=function(){return""},y.SampleEntry.prototype.getChannelCount=function(){return""},y.SampleEntry.prototype.getSampleRate=function(){return""},y.SampleEntry.prototype.getSampleSize=function(){return""},y.VisualSampleEntry.prototype.isVideo=function(){return!0},y.VisualSampleEntry.prototype.getWidth=function(){return this.width},y.VisualSampleEntry.prototype.getHeight=function(){return this.height},y.AudioSampleEntry.prototype.isAudio=function(){return!0},y.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},y.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},y.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},y.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},y.MetadataSampleEntry.prototype.isMetadata=function(){return!0},y.decimalToHex=function(t,e){var r=Number(t).toString(16);for(e=null==e?e=2:e;r.length<e;)r="0"+r;return r},y.avc1SampleEntry.prototype.getCodec=y.avc2SampleEntry.prototype.getCodec=y.avc3SampleEntry.prototype.getCodec=y.avc4SampleEntry.prototype.getCodec=function(){var t=y.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+y.decimalToHex(this.avcC.AVCProfileIndication)+y.decimalToHex(this.avcC.profile_compatibility)+y.decimalToHex(this.avcC.AVCLevelIndication):t},y.hev1SampleEntry.prototype.getCodec=y.hvc1SampleEntry.prototype.getCodec=function(){var i,t=y.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C"}t+=this.hvcC.general_profile_idc,t+=".";var e=this.hvcC.general_profile_compatibility,r=0;for(i=0;i<32&&(r|=1&e,31!=i);i++)r<<=1,e>>=1;t+=y.decimalToHex(r,0),t+=".",0===this.hvcC.general_tier_flag?t+="L":t+="H",t+=this.hvcC.general_level_idc;var n=!1,o="";for(i=5;i>=0;i--)(this.hvcC.general_constraint_indicator[i]||n)&&(o="."+y.decimalToHex(this.hvcC.general_constraint_indicator[i],0)+o,n=!0);t+=o}return t},y.vvc1SampleEntry.prototype.getCodec=y.vvi1SampleEntry.prototype.getCodec=function(){var i,t=y.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){t+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?t+=".H":t+=".L",t+=this.vvcC.general_level_idc;var e="";if(this.vvcC.general_constraint_info){var r,n=[],o=0;for(o|=this.vvcC.ptl_frame_only_constraint<<7,o|=this.vvcC.ptl_multilayer_enabled<<6,i=0;i<this.vvcC.general_constraint_info.length;++i)o|=this.vvcC.general_constraint_info[i]>>2&63,n.push(o),o&&(r=i),o=this.vvcC.general_constraint_info[i]>>2&3;if(void 0===r)e=".CA";else{e=".C";var h="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",d=0,l=0;for(i=0;i<=r;++i)for(d=d<<8|n[i],l+=8;l>=5;){e+=h[d>>l-5&31],d&=(1<<(l-=5))-1}l&&(e+=h[31&(d<<=5-l)])}}t+=e}return t},y.mp4aSampleEntry.prototype.getCodec=function(){var t=y.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),r=this.esds.esd.getAudioConfig();return t+"."+y.decimalToHex(e)+(r?"."+r:"")}return t},y.stxtSampleEntry.prototype.getCodec=function(){var t=y.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},y.vp08SampleEntry.prototype.getCodec=y.vp09SampleEntry.prototype.getCodec=function(){var t=y.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;0==e&&(e="00");var r=this.vpcC.bitDepth;return 8==r&&(r="08"),t+".0"+this.vpcC.profile+"."+e+"."+r},y.av01SampleEntry.prototype.getCodec=function(){var t,e=y.SampleEntry.prototype.getCodec.call(this),r=this.av1C.seq_level_idx_0;return r<10&&(r="0"+r),2===this.av1C.seq_profile&&1===this.av1C.high_bitdepth?t=1===this.av1C.twelve_bit?"12":"10":this.av1C.seq_profile<=2&&(t=1===this.av1C.high_bitdepth?"10":"08"),e+"."+this.av1C.seq_profile+"."+r+(this.av1C.seq_tier_0?"H":"M")+"."+t},y.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>_&&(this.size+=8),"uuid"===this.type&&(this.size+=16),d.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>_?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),"uuid"===this.type&&t.writeUint8Array(this.uuid),this.size>_&&t.writeUint64(this.size)},y.FullBox.prototype.writeHeader=function(t){this.size+=4,y.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},y.Box.prototype.write=function(t){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},y.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var i=0;i<this.boxes.length;i++)this.boxes[i]&&(this.boxes[i].write(t),this.size+=this.boxes[i].size);d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},y.TrackReferenceTypeBox.prototype.write=function(t){this.size=4*this.track_ids.length,this.writeHeader(t),t.writeUint32Array(this.track_ids)},y.avcCBox.prototype.write=function(t){var i;for(this.size=7,i=0;i<this.SPS.length;i++)this.size+=2+this.SPS[i].length;for(i=0;i<this.PPS.length;i++)this.size+=2+this.PPS[i].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),i=0;i<this.SPS.length;i++)t.writeUint16(this.SPS[i].length),t.writeUint8Array(this.SPS[i].nalu);for(t.writeUint8(this.PPS.length),i=0;i<this.PPS.length;i++)t.writeUint16(this.PPS[i].length),t.writeUint8Array(this.PPS[i].nalu);this.ext&&t.writeUint8Array(this.ext)},y.co64Box.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),i=0;i<this.chunk_offsets.length;i++)t.writeUint64(this.chunk_offsets[i])},y.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},y.cttsBox.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),i=0;i<this.sample_counts.length;i++)t.writeUint32(this.sample_counts[i]),1===this.version?t.writeInt32(this.sample_offsets[i]):t.writeUint32(this.sample_offsets[i])},y.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var i=0;i<this.entries.length;i++)this.entries[i].write(t),this.size+=this.entries[i].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},y.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},y.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var i=0;i<this.entries.length;i++){var e=this.entries[i];t.writeUint32(e.segment_duration),t.writeInt32(e.media_time),t.writeInt16(e.media_rate_integer),t.writeInt16(e.media_rate_fraction)}},y.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},y.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var i=0;i<this.compatible_brands.length;i++)t.writeString(this.compatible_brands[i],null,4)},y.hdlrBox.prototype.write=function(t){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},y.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},y.mdhdBox.prototype.write=function(t){this.size=20,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},y.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},y.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},y.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=96,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},y.SampleEntry.prototype.writeHeader=function(t){this.size=8,y.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},y.SampleEntry.prototype.writeFooter=function(t){for(var i=0;i<this.boxes.length;i++)this.boxes[i].write(t),this.size+=this.boxes[i].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},y.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},y.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=70,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},y.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=20,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},y.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},y.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},y.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var i=0;i<this.entries.length;i++){var e=this.entries[i];t.writeInt32(e.sample_count),t.writeInt32(e.group_description_index)}},y.sgpdBox.prototype.write=function(t){var i,e;for(this.flags=0,this.size=12,i=0;i<this.entries.length;i++)e=this.entries[i],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=e.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),1===this.version&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),i=0;i<this.entries.length;i++)e=this.entries[i],1===this.version&&0===this.default_length&&t.writeUint32(e.description_length),e.write(t)},y.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var i=0;i<this.references.length;i++){var e=this.references[i];t.writeUint32(e.reference_type<<31|e.referenced_size),t.writeUint32(e.subsegment_duration),t.writeUint32(e.starts_with_SAP<<31|e.SAP_type<<28|e.SAP_delta_time)}},y.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},y.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},y.stscBox.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),i=0;i<this.first_chunk.length;i++)t.writeUint32(this.first_chunk[i]),t.writeUint32(this.samples_per_chunk[i]),t.writeUint32(this.sample_description_index[i])},y.stsdBox.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,i=0;i<this.entries.length;i++)this.entries[i].write(t),this.size+=this.entries[i].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},y.stshBox.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),i=0;i<this.shadowed_sample_numbers.length;i++)t.writeUint32(this.shadowed_sample_numbers[i]),t.writeUint32(this.sync_sample_numbers[i])},y.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},y.stszBox.prototype.write=function(t){var i,e=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(i=0;i+1<this.sample_sizes.length;){if(this.sample_sizes[i+1]!==this.sample_sizes[0]){e=!1;break}i++}else e=!1;this.size=8,e||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),e?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),e||t.writeUint32Array(this.sample_sizes)},y.sttsBox.prototype.write=function(t){var i;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),i=0;i<this.sample_counts.length;i++)t.writeUint32(this.sample_counts[i]),t.writeUint32(this.sample_deltas[i])},y.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(t),1===this.version?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},y.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&y.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&y.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&y.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&y.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&y.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&y.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&y.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&y.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&y.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&y.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},y.tkhdBox.prototype.write=function(t){this.version=0,this.size=80,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},y.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},y.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&y.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&y.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&y.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&y.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&y.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&y.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&y.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&y.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var i=0;i<this.sample_count;i++)this.flags&y.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[i]),this.flags&y.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[i]),this.flags&y.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[i]),this.flags&y.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?t.writeUint32(this.sample_composition_time_offset[i]):t.writeInt32(this.sample_composition_time_offset[i]))},y["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},y["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},y.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},y.cttsBox.prototype.unpack=function(t){var i,e,r;for(r=0,i=0;i<this.sample_counts.length;i++)for(e=0;e<this.sample_counts[i];e++)t[r].pts=t[r].dts+this.sample_offsets[i],r++},y.sttsBox.prototype.unpack=function(t){var i,e,r;for(r=0,i=0;i<this.sample_counts.length;i++)for(e=0;e<this.sample_counts[i];e++)t[r].dts=0===r?0:t[r-1].dts+this.sample_deltas[i],r++},y.stcoBox.prototype.unpack=function(t){var i;for(i=0;i<this.chunk_offsets.length;i++)t[i].offset=this.chunk_offsets[i]},y.stscBox.prototype.unpack=function(t){var i,e,r,n,o;for(n=0,o=0,i=0;i<this.first_chunk.length;i++)for(e=0;e<(i+1<this.first_chunk.length?this.first_chunk[i+1]:1/0);e++)for(o++,r=0;r<this.samples_per_chunk[i];r++){if(!t[n])return;t[n].description_index=this.sample_description_index[i],t[n].chunk_index=o,n++}},y.stszBox.prototype.unpack=function(t){var i;for(i=0;i<this.sample_sizes.length;i++)t[i].size=this.sample_sizes[i]},y.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],y.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],y.boxEqualFields=function(t,e){if(t&&!e)return!1;var r;for(r in t)if(!(y.DIFF_BOXES_PROP_NAMES.indexOf(r)>-1||t[r]instanceof y.Box||e[r]instanceof y.Box||void 0===t[r]||void 0===e[r]||"function"==typeof t[r]||"function"==typeof e[r]||t.subBoxNames&&t.subBoxNames.indexOf(r.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(r.slice(0,4))>-1||"data"===r||"start"===r||"size"===r||"creation_time"===r||"modification_time"===r||y.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(r)>-1||t[r]===e[r]))return!1;return!0},y.boxEqual=function(t,e){if(!y.boxEqualFields(t,e))return!1;for(var r=0;r<y.DIFF_BOXES_PROP_NAMES.length;r++){var n=y.DIFF_BOXES_PROP_NAMES[r];if(t[n]&&e[n]&&!y.boxEqual(t[n],e[n]))return!1}return!0};var U=function(){};U.prototype.parseSample=function(data){var t,e,r=new l(data.buffer);for(t=[];!r.isEos();)(e=y.parseOneBox(r,!1)).code===y.OK&&"vttc"===e.box.type&&t.push(e.box);return t},U.prototype.getText=function(t,e,data){function r(t,e,r){return r=r||"0",(t+="").length>=e?t:new Array(e-t.length+1).join(r)+t}function n(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),s=Math.floor(t-3600*e-60*n),o=Math.floor(1e3*(t-3600*e-60*n-s));return r(e,2)+":"+r(n,2)+":"+r(s,2)+"."+r(o,3)}for(var o=this.parseSample(data),h="",i=0;i<o.length;i++){var d=o[i];h+=n(t)+" --\x3e "+n(e)+"\r\n",h+=d.payl.text}return h};var S=function(){};S.prototype.parseSample=function(t){var i,e={};e.resources=[];var r=new l(t.data.buffer);if(t.subsamples&&0!==t.subsamples.length){if(e.documentString=r.readString(t.subsamples[0].size),t.subsamples.length>1)for(i=1;i<t.subsamples.length;i++)e.resources[i]=r.readUint8Array(t.subsamples[i].size)}else e.documentString=r.readString(t.data.length);return"undefined"!=typeof DOMParser&&(e.document=(new DOMParser).parseFromString(e.documentString,"application/xml")),e};var v=function(){};v.prototype.parseSample=function(t){return new l(t.data.buffer).readString(t.data.length)},v.prototype.parseConfig=function(data){var t=new l(data.buffer);return t.readUint32(),t.readCString()},e.XMLSubtitlein4Parser=S,e.Textin4Parser=v;var x=function(t){this.stream=t||new c,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};x.prototype.setSegmentOptions=function(t,e,r){var n=this.getTrackById(t);if(n){var o={};this.fragmentedTracks.push(o),o.id=t,o.user=e,o.trak=n,n.nextSample=0,o.segmentStream=null,o.nb_samples=1e3,o.rapAlignement=!0,r&&(r.nbSamples&&(o.nb_samples=r.nbSamples),r.rapAlignement&&(o.rapAlignement=r.rapAlignement))}},x.prototype.unsetSegmentOptions=function(t){for(var e=-1,i=0;i<this.fragmentedTracks.length;i++){this.fragmentedTracks[i].id==t&&(e=i)}e>-1&&this.fragmentedTracks.splice(e,1)},x.prototype.setExtractionOptions=function(t,e,r){var n=this.getTrackById(t);if(n){var o={};this.extractedTracks.push(o),o.id=t,o.user=e,o.trak=n,n.nextSample=0,o.nb_samples=1e3,o.samples=[],r&&r.nbSamples&&(o.nb_samples=r.nbSamples)}},x.prototype.unsetExtractionOptions=function(t){for(var e=-1,i=0;i<this.extractedTracks.length;i++){this.extractedTracks[i].id==t&&(e=i)}e>-1&&this.extractedTracks.splice(e,1)},x.prototype.parse=function(){var t,e;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),(t=y.parseOneBox(this.stream,false)).code===y.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}return}var r;switch(r="uuid"!==(e=t.box).type?e.type:e.uuid,this.boxes.push(e),r){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[r]&&d.warn("ISOFile","Duplicate Box of type: "+r+", overriding previous occurrence"),this[r]=e}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},x.prototype.checkBuffer=function(t){if(null==t)throw"Buffer must be defined and non empty";if(void 0===t.fileStart)throw"Buffer must have a fileStart property";return 0===t.byteLength?(d.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(d.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),!!this.stream.initialized()||(d.warn("ISOFile","Not ready to start parsing"),!1))},x.prototype.appendBuffer=function(t,e){var r;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(r=this.nextSeekPosition,this.nextSeekPosition=void 0):r=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(r=this.stream.getEndFilePositionAfter(r))):r=this.nextParsePosition?this.nextParsePosition:0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(d.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+r),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),d.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),r},x.prototype.getInfo=function(){var i,t,e,track,r,n,o={},h=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(o.hasMoov=!0,o.duration=this.moov.mvhd.duration,o.timescale=this.moov.mvhd.timescale,o.isFragmented=null!=this.moov.mvex,o.isFragmented&&this.moov.mvex.mehd&&(o.fragment_duration=this.moov.mvex.mehd.fragment_duration),o.isProgressive=this.isProgressive,o.hasIOD=null!=this.moov.iods,o.brands=[],o.brands.push(this.ftyp.major_brand),o.brands=o.brands.concat(this.ftyp.compatible_brands),o.created=new Date(h+1e3*this.moov.mvhd.creation_time),o.modified=new Date(h+1e3*this.moov.mvhd.modification_time),o.tracks=[],o.audioTracks=[],o.videoTracks=[],o.subtitleTracks=[],o.metadataTracks=[],o.hintTracks=[],o.otherTracks=[],i=0;i<this.moov.traks.length;i++){if(n=(e=this.moov.traks[i]).mdia.minf.stbl.stsd.entries[0],track={},o.tracks.push(track),track.id=e.tkhd.track_id,track.name=e.mdia.hdlr.name,track.references=[],e.tref)for(t=0;t<e.tref.boxes.length;t++)r={},track.references.push(r),r.type=e.tref.boxes[t].type,r.track_ids=e.tref.boxes[t].track_ids;e.edts&&(track.edits=e.edts.elst.entries),track.created=new Date(h+1e3*e.tkhd.creation_time),track.modified=new Date(h+1e3*e.tkhd.modification_time),track.movie_duration=e.tkhd.duration,track.movie_timescale=o.timescale,track.layer=e.tkhd.layer,track.alternate_group=e.tkhd.alternate_group,track.volume=e.tkhd.volume,track.matrix=e.tkhd.matrix,track.track_width=e.tkhd.width/65536,track.track_height=e.tkhd.height/65536,track.timescale=e.mdia.mdhd.timescale,track.cts_shift=e.mdia.minf.stbl.cslg,track.duration=e.mdia.mdhd.duration,track.samples_duration=e.samples_duration,track.codec=n.getCodec(),track.kind=e.udta&&e.udta.kinds.length?e.udta.kinds[0]:{schemeURI:"",value:""},track.language=e.mdia.elng?e.mdia.elng.extended_language:e.mdia.mdhd.languageString,track.nb_samples=e.samples.length,track.size=e.samples_size,track.bitrate=8*track.size*track.timescale/track.samples_duration,n.isAudio()?(track.type="audio",o.audioTracks.push(track),track.audio={},track.audio.sample_rate=n.getSampleRate(),track.audio.channel_count=n.getChannelCount(),track.audio.sample_size=n.getSampleSize()):n.isVideo()?(track.type="video",o.videoTracks.push(track),track.video={},track.video.width=n.getWidth(),track.video.height=n.getHeight()):n.isSubtitle()?(track.type="subtitles",o.subtitleTracks.push(track)):n.isHint()?(track.type="metadata",o.hintTracks.push(track)):n.isMetadata()?(track.type="metadata",o.metadataTracks.push(track)):(track.type="metadata",o.otherTracks.push(track))}else o.hasMoov=!1;if(o.mime="",o.hasMoov&&o.tracks){for(o.videoTracks&&o.videoTracks.length>0?o.mime+='video/mp4; codecs="':o.audioTracks&&o.audioTracks.length>0?o.mime+='audio/mp4; codecs="':o.mime+='application/mp4; codecs="',i=0;i<o.tracks.length;i++)0!==i&&(o.mime+=","),o.mime+=o.tracks[i].codec;o.mime+='"; profiles="',o.mime+=this.ftyp.compatible_brands.join(),o.mime+='"'}return o},x.prototype.processSamples=function(t){var i,e;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(i=0;i<this.fragmentedTracks.length;i++){var r=this.fragmentedTracks[i];for(e=r.trak;e.nextSample<e.samples.length&&this.sampleProcessingStarted;){d.debug("ISOFile","Creating media fragment on track #"+r.id+" for sample "+e.nextSample);var n=this.createFragment(r.id,e.nextSample,r.segmentStream);if(!n)break;if(r.segmentStream=n,e.nextSample++,(e.nextSample%r.nb_samples==0||t||e.nextSample>=e.samples.length)&&(d.info("ISOFile","Sending fragmented data on track #"+r.id+" for samples ["+Math.max(0,e.nextSample-r.nb_samples)+","+(e.nextSample-1)+"]"),d.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(r.id,r.user,r.segmentStream.buffer,e.nextSample,t||e.nextSample>=e.samples.length),r.segmentStream=null,r!==this.fragmentedTracks[i]))break}}if(null!==this.onSamples)for(i=0;i<this.extractedTracks.length;i++){var o=this.extractedTracks[i];for(e=o.trak;e.nextSample<e.samples.length&&this.sampleProcessingStarted;){d.debug("ISOFile","Exporting on track #"+o.id+" sample #"+e.nextSample);var h=this.getSample(e,e.nextSample);if(!h)break;if(e.nextSample++,o.samples.push(h),(e.nextSample%o.nb_samples==0||e.nextSample>=e.samples.length)&&(d.debug("ISOFile","Sending samples on track #"+o.id+" for sample "+e.nextSample),this.onSamples&&this.onSamples(o.id,o.user,o.samples),o.samples=[],o!==this.extractedTracks[i]))break}}}},x.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},x.prototype.getBoxes=function(t,e){var r=[];return x._sweep.call(this,t,r,e),r},x._sweep=function(t,e,r){for(var n in this.type&&this.type==t&&e.push(this),this.boxes){if(e.length&&r)return;x._sweep.call(this.boxes[n],t,e,r)}},x.prototype.getTrackSamplesInfo=function(t){var track=this.getTrackById(t);return track?track.samples:void 0},x.prototype.getTrackSample=function(t,e){var track=this.getTrackById(t);return this.getSample(track,e)},x.prototype.releaseUsedSamples=function(t,e){var r=0,n=this.getTrackById(t);n.lastValidSample||(n.lastValidSample=0);for(var i=n.lastValidSample;i<e;i++)r+=this.releaseSample(n,i);d.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+r+", remaining: "+this.samplesDataSize+")"),n.lastValidSample=e},x.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},x.prototype.stop=function(){this.sampleProcessingStarted=!1},x.prototype.flush=function(){d.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},x.prototype.seekTrack=function(time,t,e){var r,n,o,h,l=0,f=0;if(0===e.samples.length)return d.info("ISOFile","No sample in track, cannot seek! Using time "+d.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(r=0;r<e.samples.length;r++){if(n=e.samples[r],0===r)f=0,h=n.timescale;else if(n.cts>time*n.timescale){f=r-1;break}t&&n.is_sync&&(l=r)}for(t&&(f=l),time=e.samples[f].cts,e.nextSample=f;e.samples[f].alreadyRead===e.samples[f].size&&e.samples[f+1];)f++;return o=e.samples[f].offset+e.samples[f].alreadyRead,d.info("ISOFile","Seeking to "+(t?"RAP":"")+" sample #"+e.nextSample+" on track "+e.tkhd.track_id+", time "+d.getDurationString(time,h)+" and offset: "+o),{offset:o,time:time/h}},x.prototype.seek=function(time,t){var e,r,i,n=this.moov,o={offset:1/0,time:1/0};if(this.moov){for(i=0;i<n.traks.length;i++)e=n.traks[i],(r=this.seekTrack(time,t,e)).offset<o.offset&&(o.offset=r.offset),r.time<o.time&&(o.time=r.time);return d.info("ISOFile","Seeking at time "+d.getDurationString(o.time,1)+" needs a buffer with a fileStart position of "+o.offset),o.offset===1/0?o={offset:this.nextParsePosition,time:0}:o.offset=this.stream.getEndFilePositionAfter(o.offset),d.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+o.offset),o}throw"Cannot seek: moov not received!"},x.prototype.equal=function(b){for(var t=0;t<this.boxes.length&&t<b.boxes.length;){var e=this.boxes[t],r=b.boxes[t];if(!y.boxEqual(e,r))return!1;t++}return!0},e.ISOFile=x,x.prototype.lastBoxStartPosition=0,x.prototype.parsingMdat=null,x.prototype.nextParsePosition=0,x.prototype.discardMdatData=!1,x.prototype.processIncompleteBox=function(t){var e;return"mdat"===t.type?(e=new y[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,this.stream.seek(e.start+e.size,!1,this.discardMdatData)?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):("moov"===t.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),!!this.stream.mergeNextBuffer&&this.stream.mergeNextBuffer()?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},x.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},x.prototype.processIncompleteMdat=function(){var t;return t=this.parsingMdat,this.stream.seek(t.start+t.size,!1,this.discardMdatData)?(d.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},x.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},x.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},x.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&("mdat"===t.type?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},x.prototype.add=y.Box.prototype.add,x.prototype.addBox=y.Box.prototype.addBox,x.prototype.init=function(t){var e=t||{},r=(this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]),this.add("moov"));return r.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),r.add("mvex"),this},x.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var r=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,r.add("tkhd").set("flags",y.TKHD_FLAG_ENABLED|y.TKHD_FLAG_IN_MOVIE|y.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",e.width<<16).set("height",e.height<<16);var n=r.add("mdia");n.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),n.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),n.add("elng").set("extended_language",e.language||"fr-FR");var o=n.add("minf");if(void 0!==y[e.type+"SampleEntry"]){var h=new y[e.type+"SampleEntry"];h.data_reference_index=1;var d="";for(var f in y.sampleEntryCodes)for(var _=y.sampleEntryCodes[f],i=0;i<_.length;i++)if(_.indexOf(e.type)>-1){d=f;break}switch(d){case"Visual":if(o.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),h.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var c=new y.avcCBox,m=new l(e.avcDecoderConfigRecord);c.parse(m),h.addBox(c)}break;case"Audio":o.add("smhd").set("balance",e.balance||0),h.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":o.add("hmhd");break;case"Subtitle":if(o.add("sthd"),"stpp"===e.type)h.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break;default:o.add("nmhd")}e.description&&h.addBox(e.description),e.description_boxes&&e.description_boxes.forEach((function(b){h.addBox(b)})),o.add("dinf").add("dref").addEntry((new y["url Box"]).set("flags",1));var U=o.add("stbl");return U.add("stsd").addEntry(h),U.add("stts").set("sample_counts",[]).set("sample_deltas",[]),U.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),U.add("stco").set("chunk_offsets",[]),U.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(r),e.id}},y.Box.prototype.computeSize=function(t){var e=t||new f;e.endianness=f.BIG_ENDIAN,this.write(e)},x.prototype.addSample=function(t,data,e){var r=e||{},n={},o=this.getTrackById(t);if(null!==o){n.number=o.samples.length,n.track_id=o.tkhd.track_id,n.timescale=o.mdia.mdhd.timescale,n.description_index=r.sample_description_index?r.sample_description_index-1:0,n.description=o.mdia.minf.stbl.stsd.entries[n.description_index],n.data=data,n.size=data.byteLength,n.alreadyRead=n.size,n.duration=r.duration||1,n.cts=r.cts||0,n.dts=r.dts||0,n.is_sync=r.is_sync||!1,n.is_leading=r.is_leading||0,n.depends_on=r.depends_on||0,n.is_depended_on=r.is_depended_on||0,n.has_redundancy=r.has_redundancy||0,n.degradation_priority=r.degradation_priority||0,n.offset=0,n.subsamples=r.subsamples,o.samples.push(n),o.samples_size+=n.size,o.samples_duration+=n.duration,o.first_dts||(o.first_dts=r.dts),this.processSamples();var h=this.createSingleSampleMoof(n);return this.addBox(h),h.computeSize(),h.trafs[0].truns[0].data_offset=h.size+8,this.add("mdat").data=new Uint8Array(data),n}},x.prototype.createSingleSampleMoof=function(t){var e=0;e=t.is_sync?1<<25:65536;var r=new y.moofBox;r.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var n=r.add("traf"),o=this.getTrackById(t.track_id);return n.add("tfhd").set("track_id",t.track_id).set("flags",y.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),n.add("tfdt").set("baseMediaDecodeTime",t.dts-(o.first_dts||0)),n.add("trun").set("flags",y.TRUN_FLAGS_DATA_OFFSET|y.TRUN_FLAGS_DURATION|y.TRUN_FLAGS_SIZE|y.TRUN_FLAGS_FLAGS|y.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),r},x.prototype.lastMoofIndex=0,x.prototype.samplesDataSize=0,x.prototype.resetTables=function(){var i,t,e,r,n,o;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,i=0;i<this.moov.traks.length;i++){(t=this.moov.traks[i]).tkhd.duration=0,t.mdia.mdhd.duration=0,(t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64).chunk_offsets=[],(e=t.mdia.minf.stbl.stsc).first_chunk=[],e.samples_per_chunk=[],e.sample_description_index=[],(t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2).sample_sizes=[],(r=t.mdia.minf.stbl.stts).sample_counts=[],r.sample_deltas=[],(n=t.mdia.minf.stbl.ctts)&&(n.sample_counts=[],n.sample_offsets=[]),o=t.mdia.minf.stbl.stss;var h=t.mdia.minf.stbl.boxes.indexOf(o);-1!=h&&(t.mdia.minf.stbl.boxes[h]=null)}},x.initSampleGroups=function(t,e,r,n,o){var h,d,l,f;function _(t,e,r){this.grouping_type=t,this.grouping_type_parameter=e,this.sbgp=r,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),d=0;d<r.length;d++){for(f=r[d].grouping_type+"/"+r[d].grouping_type_parameter,l=new _(r[d].grouping_type,r[d].grouping_type_parameter,r[d]),e&&(e.sample_groups_info[f]=l),t.sample_groups_info[f]||(t.sample_groups_info[f]=l),h=0;h<n.length;h++)n[h].grouping_type===r[d].grouping_type&&(l.description=n[h],l.description.used=!0);if(o)for(h=0;h<o.length;h++)o[h].grouping_type===r[d].grouping_type&&(l.fragment_description=o[h],l.fragment_description.used=!0,l.is_fragment=!0)}if(e){if(o)for(d=0;d<o.length;d++)!o[d].used&&o[d].version>=2&&(f=o[d].grouping_type+"/0",(l=new _(o[d].grouping_type,0)).is_fragment=!0,e.sample_groups_info[f]||(e.sample_groups_info[f]=l))}else for(d=0;d<n.length;d++)!n[d].used&&n[d].version>=2&&(f=n[d].grouping_type+"/0",l=new _(n[d].grouping_type,0),t.sample_groups_info[f]||(t.sample_groups_info[f]=l))},x.setSampleGroupProperties=function(t,e,r,n){var o,h;for(o in e.sample_groups=[],n){var d;if(e.sample_groups[o]={},e.sample_groups[o].grouping_type=n[o].grouping_type,e.sample_groups[o].grouping_type_parameter=n[o].grouping_type_parameter,r>=n[o].last_sample_in_run&&(n[o].last_sample_in_run<0&&(n[o].last_sample_in_run=0),n[o].entry_index++,n[o].entry_index<=n[o].sbgp.entries.length-1&&(n[o].last_sample_in_run+=n[o].sbgp.entries[n[o].entry_index].sample_count)),n[o].entry_index<=n[o].sbgp.entries.length-1?e.sample_groups[o].group_description_index=n[o].sbgp.entries[n[o].entry_index].group_description_index:e.sample_groups[o].group_description_index=-1,0!==e.sample_groups[o].group_description_index)d=n[o].fragment_description?n[o].fragment_description:n[o].description,e.sample_groups[o].group_description_index>0?(h=e.sample_groups[o].group_description_index>65535?(e.sample_groups[o].group_description_index>>16)-1:e.sample_groups[o].group_description_index-1,d&&h>=0&&(e.sample_groups[o].description=d.entries[h])):d&&d.version>=2&&d.default_group_description_index>0&&(e.sample_groups[o].description=d.entries[d.default_group_description_index-1])}},x.process_sdtp=function(t,e,r){e&&(t?(e.is_leading=t.is_leading[r],e.depends_on=t.sample_depends_on[r],e.is_depended_on=t.sample_is_depended_on[r],e.has_redundancy=t.sample_has_redundancy[r]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},x.prototype.buildSampleLists=function(){var i,t;for(i=0;i<this.moov.traks.length;i++)t=this.moov.traks[i],this.buildTrakSampleLists(t)},x.prototype.buildTrakSampleLists=function(t){var e,r,n,o,h,d,l,f,_,c,m,y,U,S,v,w,E,B,A,z,T,I,C,F;if(t.samples=[],t.samples_duration=0,t.samples_size=0,r=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,n=t.mdia.minf.stbl.stsc,o=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,h=t.mdia.minf.stbl.stts,d=t.mdia.minf.stbl.ctts,l=t.mdia.minf.stbl.stss,f=t.mdia.minf.stbl.stsd,_=t.mdia.minf.stbl.subs,y=t.mdia.minf.stbl.stdp,c=t.mdia.minf.stbl.sbgps,m=t.mdia.minf.stbl.sgpds,B=-1,A=-1,z=-1,T=-1,I=0,C=0,F=0,x.initSampleGroups(t,null,c,m),void 0!==o){for(e=0;e<o.sample_sizes.length;e++){var k={};k.number=e,k.track_id=t.tkhd.track_id,k.timescale=t.mdia.mdhd.timescale,k.alreadyRead=0,t.samples[e]=k,k.size=o.sample_sizes[e],t.samples_size+=k.size,0===e?(S=1,U=0,k.chunk_index=S,k.chunk_run_index=U,E=n.samples_per_chunk[U],w=0,v=U+1<n.first_chunk.length?n.first_chunk[U+1]-1:1/0):e<E?(k.chunk_index=S,k.chunk_run_index=U):(S++,k.chunk_index=S,w=0,S<=v||(v=++U+1<n.first_chunk.length?n.first_chunk[U+1]-1:1/0),k.chunk_run_index=U,E+=n.samples_per_chunk[U]),k.description_index=n.sample_description_index[k.chunk_run_index]-1,k.description=f.entries[k.description_index],k.offset=r.chunk_offsets[k.chunk_index-1]+w,w+=k.size,e>B&&(A++,B<0&&(B=0),B+=h.sample_counts[A]),e>0?(t.samples[e-1].duration=h.sample_deltas[A],t.samples_duration+=t.samples[e-1].duration,k.dts=t.samples[e-1].dts+t.samples[e-1].duration):k.dts=0,d?(e>=z&&(T++,z<0&&(z=0),z+=d.sample_counts[T]),k.cts=t.samples[e].dts+d.sample_offsets[T]):k.cts=k.dts,l?(e==l.sample_numbers[I]-1?(k.is_sync=!0,I++):(k.is_sync=!1,k.degradation_priority=0),_&&_.entries[C].sample_delta+F==e+1&&(k.subsamples=_.entries[C].subsamples,F+=_.entries[C].sample_delta,C++)):k.is_sync=!0,x.process_sdtp(t.mdia.minf.stbl.sdtp,k,k.number),k.degradation_priority=y?y.priority[e]:0,_&&_.entries[C].sample_delta+F==e&&(k.subsamples=_.entries[C].subsamples,F+=_.entries[C].sample_delta),(c.length>0||m.length>0)&&x.setSampleGroupProperties(t,k,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},x.prototype.updateSampleLists=function(){var i,t,e,r,n,o,h,d,l,f,_,c,m,U,S;if(void 0!==this.moov)for(;this.lastMoofIndex<this.moofs.length;)if(l=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==l.type)for(f=l,i=0;i<f.trafs.length;i++){for(_=f.trafs[i],c=this.getTrackById(_.tfhd.track_id),m=this.getTrexById(_.tfhd.track_id),r=_.tfhd.flags&y.TFHD_FLAG_SAMPLE_DESC?_.tfhd.default_sample_description_index:m?m.default_sample_description_index:1,n=_.tfhd.flags&y.TFHD_FLAG_SAMPLE_DUR?_.tfhd.default_sample_duration:m?m.default_sample_duration:0,o=_.tfhd.flags&y.TFHD_FLAG_SAMPLE_SIZE?_.tfhd.default_sample_size:m?m.default_sample_size:0,h=_.tfhd.flags&y.TFHD_FLAG_SAMPLE_FLAGS?_.tfhd.default_sample_flags:m?m.default_sample_flags:0,_.sample_number=0,_.sbgps.length>0&&x.initSampleGroups(c,_,_.sbgps,c.mdia.minf.stbl.sgpds,_.sgpds),t=0;t<_.truns.length;t++){var v=_.truns[t];for(e=0;e<v.sample_count;e++){(U={}).moof_number=this.lastMoofIndex,U.number_in_traf=_.sample_number,_.sample_number++,U.number=c.samples.length,_.first_sample_index=c.samples.length,c.samples.push(U),U.track_id=c.tkhd.track_id,U.timescale=c.mdia.mdhd.timescale,U.description_index=r-1,U.description=c.mdia.minf.stbl.stsd.entries[U.description_index],U.size=o,v.flags&y.TRUN_FLAGS_SIZE&&(U.size=v.sample_size[e]),c.samples_size+=U.size,U.duration=n,v.flags&y.TRUN_FLAGS_DURATION&&(U.duration=v.sample_duration[e]),c.samples_duration+=U.duration,c.first_traf_merged||e>0?U.dts=c.samples[c.samples.length-2].dts+c.samples[c.samples.length-2].duration:(_.tfdt?U.dts=_.tfdt.baseMediaDecodeTime:U.dts=0,c.first_traf_merged=!0),U.cts=U.dts,v.flags&y.TRUN_FLAGS_CTS_OFFSET&&(U.cts=U.dts+v.sample_composition_time_offset[e]),S=h,v.flags&y.TRUN_FLAGS_FLAGS?S=v.sample_flags[e]:0===e&&v.flags&y.TRUN_FLAGS_FIRST_FLAG&&(S=v.first_sample_flags),U.is_sync=!(S>>16&1),U.is_leading=S>>26&3,U.depends_on=S>>24&3,U.is_depended_on=S>>22&3,U.has_redundancy=S>>20&3,U.degradation_priority=65535&S;var w=!!(_.tfhd.flags&y.TFHD_FLAG_BASE_DATA_OFFSET),E=!!(_.tfhd.flags&y.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),B=!!(v.flags&y.TRUN_FLAGS_DATA_OFFSET),bdo=0;bdo=w?_.tfhd.base_data_offset:E||0===t?f.start:d,U.offset=0===t&&0===e?B?bdo+v.data_offset:bdo:d,d=U.offset+U.size,(_.sbgps.length>0||_.sgpds.length>0||c.mdia.minf.stbl.sbgps.length>0||c.mdia.minf.stbl.sgpds.length>0)&&x.setSampleGroupProperties(c,U,U.number_in_traf,_.sample_groups_info)}}if(_.subs){c.has_fragment_subsamples=!0;var A=_.first_sample_index;for(t=0;t<_.subs.entries.length;t++)A+=_.subs.entries[t].sample_delta,(U=c.samples[A-1]).subsamples=_.subs.entries[t].subsamples}}},x.prototype.getSample=function(t,e){var r,n=t.samples[e];if(!this.moov)return null;if(n.data){if(n.alreadyRead==n.size)return n}else n.data=new Uint8Array(n.size),n.alreadyRead=0,this.samplesDataSize+=n.size,d.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+n.size+" (total: "+this.samplesDataSize+")");for(;;){var o=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(!(o>-1))return null;var h=(r=this.stream.buffers[o]).byteLength-(n.offset+n.alreadyRead-r.fileStart);if(n.size-n.alreadyRead<=h)return d.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-r.fileStart)+" read size: "+(n.size-n.alreadyRead)+" full size: "+n.size+")"),f.memcpy(n.data.buffer,n.alreadyRead,r,n.offset+n.alreadyRead-r.fileStart,n.size-n.alreadyRead),r.usedBytes+=n.size-n.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead=n.size,n;if(0===h)return null;d.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-r.fileStart)+" read size: "+h+" full size: "+n.size+")"),f.memcpy(n.data.buffer,n.alreadyRead,r,n.offset+n.alreadyRead-r.fileStart,h),n.alreadyRead+=h,r.usedBytes+=h,this.stream.logBufferLevel()}},x.prototype.releaseSample=function(t,e){var r=t.samples[e];return r.data?(this.samplesDataSize-=r.size,r.data=null,r.alreadyRead=0,r.size):0},x.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},x.prototype.getCodecs=function(){var i,t="";for(i=0;i<this.moov.traks.length;i++){i>0&&(t+=","),t+=this.moov.traks[i].mdia.minf.stbl.stsd.entries[0].getCodec()}return t},x.prototype.getTrexById=function(t){var i;if(!this.moov||!this.moov.mvex)return null;for(i=0;i<this.moov.mvex.trexs.length;i++){var e=this.moov.mvex.trexs[i];if(e.track_id==t)return e}return null},x.prototype.getTrackById=function(t){if(void 0===this.moov)return null;for(var e=0;e<this.moov.traks.length;e++){var r=this.moov.traks[e];if(r.tkhd.track_id==t)return r}return null},x.prototype.items=[],x.prototype.itemsDataSize=0,x.prototype.flattenItemInfo=function(){var i,t,e,r=this.items,meta=this.meta;if(null!=meta&&void 0!==meta.hdlr&&void 0!==meta.iinf){for(i=0;i<meta.iinf.item_infos.length;i++)(e={}).id=meta.iinf.item_infos[i].item_ID,r[e.id]=e,e.ref_to=[],e.name=meta.iinf.item_infos[i].item_name,meta.iinf.item_infos[i].protection_index>0&&(e.protection=meta.ipro.protections[meta.iinf.item_infos[i].protection_index-1]),meta.iinf.item_infos[i].item_type?e.type=meta.iinf.item_infos[i].item_type:e.type="mime",e.content_type=meta.iinf.item_infos[i].content_type,e.content_encoding=meta.iinf.item_infos[i].content_encoding;if(meta.iloc)for(i=0;i<meta.iloc.items.length;i++){var n=meta.iloc.items[i];switch(e=r[n.item_ID],0!==n.data_reference_index&&(d.warn("Item storage with reference to other files: not supported"),e.source=meta.dinf.boxes[n.data_reference_index-1]),n.construction_method){case 0:break;case 1:case 2:d.warn("Item storage with construction_method : not supported")}for(e.extents=[],e.size=0,t=0;t<n.extents.length;t++)e.extents[t]={},e.extents[t].offset=n.extents[t].extent_offset+n.base_offset,e.extents[t].length=n.extents[t].extent_length,e.extents[t].alreadyRead=0,e.size+=e.extents[t].length}if(meta.pitm&&(r[meta.pitm.item_id].primary=!0),meta.iref)for(i=0;i<meta.iref.references.length;i++){var o=meta.iref.references[i];for(t=0;t<o.references.length;t++)r[o.from_item_ID].ref_to.push({type:o.type,id:o.references[t]})}if(meta.iprp)for(var h=0;h<meta.iprp.ipmas.length;h++){var l=meta.iprp.ipmas[h];for(i=0;i<l.associations.length;i++){var f=l.associations[i];for(void 0===(e=r[f.id]).properties&&(e.properties={},e.properties.boxes=[]),t=0;t<f.props.length;t++){var _=f.props[t];if(_.property_index>0&&_.property_index-1<meta.iprp.ipco.boxes.length){var c=meta.iprp.ipco.boxes[_.property_index-1];e.properties[c.type]=c,e.properties.boxes.push(c)}}}}}},x.prototype.getItem=function(t){var e,r;if(!this.meta)return null;if(!(r=this.items[t]).data&&r.size)r.data=new Uint8Array(r.size),r.alreadyRead=0,this.itemsDataSize+=r.size,d.debug("ISOFile","Allocating item #"+t+" of size "+r.size+" (total: "+this.itemsDataSize+")");else if(r.alreadyRead===r.size)return r;for(var i=0;i<r.extents.length;i++){var n=r.extents[i];if(n.alreadyRead!==n.length){var o=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(!(o>-1))return null;var h=(e=this.stream.buffers[o]).byteLength-(n.offset+n.alreadyRead-e.fileStart);if(!(n.length-n.alreadyRead<=h))return d.debug("ISOFile","Getting item #"+t+" extent #"+i+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-e.fileStart)+" read size: "+h+" full extent size: "+n.length+" full item size: "+r.size+")"),f.memcpy(r.data.buffer,r.alreadyRead,e,n.offset+n.alreadyRead-e.fileStart,h),n.alreadyRead+=h,r.alreadyRead+=h,e.usedBytes+=h,this.stream.logBufferLevel(),null;d.debug("ISOFile","Getting item #"+t+" extent #"+i+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-e.fileStart)+" read size: "+(n.length-n.alreadyRead)+" full extent size: "+n.length+" full item size: "+r.size+")"),f.memcpy(r.data.buffer,r.alreadyRead,e,n.offset+n.alreadyRead-e.fileStart,n.length-n.alreadyRead),e.usedBytes+=n.length-n.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead+=n.length-n.alreadyRead,n.alreadyRead=n.length}}return r.alreadyRead===r.size?r:null},x.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var i=0;i<e.extents.length;i++){e.extents[i].alreadyRead=0}return e.size}return 0},x.prototype.processItems=function(t){for(var i in this.items){var e=this.items[i];this.getItem(e.id),t&&!e.sent&&(t(e),e.sent=!0,e.data=null)}},x.prototype.hasItem=function(t){for(var i in this.items){var e=this.items[i];if(e.name===t)return e.id}return-1},x.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},x.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},x.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},r=null;if(null==(r=e.itemId?this.getItem(e.itemId):this.getPrimaryItem()))return null;var n=new x;n.discardMdatData=!1;var o={type:r.type,description_boxes:r.properties.boxes};r.properties.ispe&&(o.width=r.properties.ispe.image_width,o.height=r.properties.ispe.image_height);var h=n.addTrack(o);return h?(n.addSample(h,r.data),n):null},x.prototype.write=function(t){for(var i=0;i<this.boxes.length;i++)this.boxes[i].write(t)},x.prototype.createFragment=function(t,e,r){var n=this.getTrackById(t),o=this.getSample(n,e);if(null==o)return o=n.samples[e],this.nextSeekPosition?this.nextSeekPosition=Math.min(o.offset+o.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=n.samples[e].offset+o.alreadyRead,null;var h=r||new f;h.endianness=f.BIG_ENDIAN;var l=this.createSingleSampleMoof(o);l.write(h),l.trafs[0].truns[0].data_offset=l.size+8,d.debug("MP4Box","Adjusting data_offset with new value "+l.trafs[0].truns[0].data_offset),h.adjustUint32(l.trafs[0].truns[0].data_offset_position,l.trafs[0].truns[0].data_offset);var _=new y.mdatBox;return _.data=o.data,_.write(h),h},x.writeInitializationSegment=function(t,e,r,n){var i;d.debug("ISOFile","Generating initialization segment");var o=new f;o.endianness=f.BIG_ENDIAN,t.write(o);var h=e.add("mvex");for(r&&h.add("mehd").set("fragment_duration",r),i=0;i<e.traks.length;i++)h.add("trex").set("track_id",e.traks[i].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",n).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(o),o.buffer},x.prototype.save=function(t){var e=new f;e.endianness=f.BIG_ENDIAN,this.write(e),e.save(t)},x.prototype.getBuffer=function(){var t=new f;return t.endianness=f.BIG_ENDIAN,this.write(t),t.buffer},x.prototype.initializeSegmentation=function(){var i,t,e,r;for(null===this.onSegment&&d.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),t=[],i=0;i<this.fragmentedTracks.length;i++){var n=new y.moovBox;n.mvhd=this.moov.mvhd,n.boxes.push(n.mvhd),e=this.getTrackById(this.fragmentedTracks[i].id),n.boxes.push(e),n.traks.push(e),(r={}).id=e.tkhd.track_id,r.user=this.fragmentedTracks[i].user,r.buffer=x.writeInitializationSegment(this.ftyp,n,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[i].samples.length>0?this.moov.traks[i].samples[0].duration:0),t.push(r)}return t},y.Box.prototype.printHeader=function(output){this.size+=8,this.size>_&&(this.size+=8),"uuid"===this.type&&(this.size+=16),output.log(output.indent+"size:"+this.size),output.log(output.indent+"type:"+this.type)},y.FullBox.prototype.printHeader=function(output){this.size+=4,y.Box.prototype.printHeader.call(this,output),output.log(output.indent+"version:"+this.version),output.log(output.indent+"flags:"+this.flags)},y.Box.prototype.print=function(output){this.printHeader(output)},y.ContainerBox.prototype.print=function(output){this.printHeader(output);for(var i=0;i<this.boxes.length;i++)if(this.boxes[i]){var t=output.indent;output.indent+=" ",this.boxes[i].print(output),output.indent=t}},x.prototype.print=function(output){output.indent="";for(var i=0;i<this.boxes.length;i++)this.boxes[i]&&this.boxes[i].print(output)},y.mvhdBox.prototype.print=function(output){y.FullBox.prototype.printHeader.call(this,output),output.log(output.indent+"creation_time: "+this.creation_time),output.log(output.indent+"modification_time: "+this.modification_time),output.log(output.indent+"timescale: "+this.timescale),output.log(output.indent+"duration: "+this.duration),output.log(output.indent+"rate: "+this.rate),output.log(output.indent+"volume: "+(this.volume>>8)),output.log(output.indent+"matrix: "+this.matrix.join(", ")),output.log(output.indent+"next_track_id: "+this.next_track_id)},y.tkhdBox.prototype.print=function(output){y.FullBox.prototype.printHeader.call(this,output),output.log(output.indent+"creation_time: "+this.creation_time),output.log(output.indent+"modification_time: "+this.modification_time),output.log(output.indent+"track_id: "+this.track_id),output.log(output.indent+"duration: "+this.duration),output.log(output.indent+"volume: "+(this.volume>>8)),output.log(output.indent+"matrix: "+this.matrix.join(", ")),output.log(output.indent+"layer: "+this.layer),output.log(output.indent+"alternate_group: "+this.alternate_group),output.log(output.indent+"width: "+this.width),output.log(output.indent+"height: "+this.height)};var w={createFile:function(t,e){var r=void 0===t||t,n=new x(e);return n.discardMdatData=!r,n}};e.createFile=w.createFile}}]);